<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Definition of Derivative</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- MathQuill resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.js"></script>
    
    <style>
        :root {
            --main-color: #323232;
            --accent-color: #ff6b6b;
            --secondary-color: #feca57;
            --tertiary-color: #1dd1a1;
            --bg-color: #f7f9fc;
            --font-color: #323232;
            --font-color-sub: #666;
            --shadow-md: 4px 4px var(--main-color);
            --shadow-lg: 6px 6px var(--main-color);
        }

        body {
            font-family: 'Poppins', sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background: var(--bg-color);
            color: var(--font-color);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 40px;
            border-radius: 10px;
            background-color: white;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--main-color);
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 260px;
            height: 100%;
            background-color: #feca57;
            border-right: 2px solid var(--main-color);
            box-shadow: 4px 0 var(--main-color);
            overflow-x: hidden;
            padding: 30px 20px;
            z-index: 100;
        }

        .sidebar a, .dropdown-btn {
            padding: 15px 20px;
            font-size: 16px;
            color: var(--font-color);
            transition: all 0.3s ease;
            border-radius: 10px;
            margin: 8px 0;
            text-decoration: none;
            display: block;
            border: 2px solid var(--main-color);
            background-color: white;
            width: calc(100% - 40px);
            text-align: left;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            box-shadow: var(--shadow-md);
            font-weight: 600;
        }

        .sidebar a:hover, .dropdown-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .sidebar a.active {
            background-color: var(--accent-color);
            color: white;
        }

        .dropdown-container {
            background-color: transparent;
            padding-left: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .dropdown-btn.active + .dropdown-container {
            max-height: 300px;
        }

        .dropdown-btn::after {
            content: '▼';
            position: absolute;
            right: 15px;
            transition: transform 0.3s ease;
            font-size: 12px;
        }

        .dropdown-btn.active::after {
            transform: rotate(180deg);
        }

        h1 {
            color: var(--font-color);
            font-size: 2.5rem;
            margin: 30px 0;
            font-weight: 700;
        }

        h2 {
            color: var(--font-color);
            font-size: 2rem;
            margin: 25px 0;
            font-weight: 600;
            background: var(--main-color);
            color: white;
            padding: 15px;
            border-radius: 25px;
        }

        h3 {
            color: var(--font-color);
            font-size: 1.5rem;
            margin: 20px 0;
            font-weight: 600;
        }

        .definition-box {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            padding: 35px;
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(50, 50, 50, 0.1);
            border: 3px solid var(--main-color);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .definition-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color), var(--tertiary-color));
        }

        .example-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--main-color);
            text-align: left;
        }

        .example-title {
            background: var(--main-color);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .tip-box {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid var(--tertiary-color);
            position: relative;
        }

        .tip-icon {
            background: var(--main-color);
            color: white;
            width: 40px;
            height: 25px;
            border-radius: 15px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .solution-steps {
            background: #fafafa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #ddd;
        }

        .warning-box {
            background: #fff9c4;
            border: 2px solid #f39c12;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            align-items: flex-start;
        }

        .warning-icon {
            background: #f39c12;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .button {
            background: white;
            color: var(--font-color);
            padding: 12px 25px;
            border: 2px solid var(--main-color);
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
        }

        .button:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        p {
            text-align: left;
            margin: 15px 0;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        ul, ol {
            text-align: left;
            padding-left: 20px;
        }

        li {
            margin-bottom: 8px;
        }

                 .math-expression {
             font-size: 1.2rem;
            margin: 15px 0;
             padding: 10px;
             background: #f8f9fa;
             border-radius: 5px;
             text-align: center;
         }

         /* Interactive Elements */
         .interactive-section {
             background: #e8f5e8;
             border: 2px solid var(--tertiary-color);
            border-radius: 10px;
             padding: 25px;
             margin: 25px 0;
         }

         .practice-problem {
             background: #fff3e0;
             border: 2px solid #ff9800;
             border-radius: 10px;
             padding: 20px;
             margin: 20px 0;
         }

         .step-by-step {
             background: #f3e5f5;
             border: 2px solid #9c27b0;
             border-radius: 10px;
             padding: 20px;
             margin: 20px 0;
         }

         .mathquill-field {
             border: 3px solid var(--main-color);
             border-radius: 12px;
             padding: 20px 25px;
             margin: 15px 0;
            background: white;
             min-height: 80px;
             font-size: 24px;
             transition: all 0.3s ease;
             box-shadow: 0 4px 12px rgba(50, 50, 50, 0.1);
             width: 100%;
             max-width: 600px;
             display: flex;
             align-items: center;
             justify-content: flex-start;
             position: relative;
             cursor: text;
        }

        .mathquill-field:focus-within {
             border-color: var(--accent-color);
             box-shadow: 0 0 15px rgba(255, 107, 107, 0.4);
             transform: translateY(-3px);
             background: linear-gradient(145deg, #ffffff, #f8fafc);
         }

         .mathquill-field:hover {
             border-color: var(--tertiary-color);
             box-shadow: 0 0 10px rgba(29, 209, 161, 0.2);
             transform: translateY(-1px);
         }

         /* MathQuill internal styling overrides */
         .mathquill-field .mq-editable-field {
             font-size: 24px !important;
             min-height: 40px !important;
             padding: 10px !important;
             width: 100% !important;
         }

         .mathquill-field .mq-root-block {
             font-size: 24px !important;
             line-height: 1.4 !important;
         }

         .mathquill-field .mq-cursor {
             border-left: 3px solid var(--accent-color) !important;
             height: 30px !important;
             animation: blink 1s infinite;
         }

         @keyframes blink {
             0%, 50% { opacity: 1; }
             51%, 100% { opacity: 0; }
         }

         /* Add placeholder-like styling when empty */
         .mathquill-field:empty::before {
             content: "Enter your mathematical expression here...";
             color: #9ca3af;
             font-style: italic;
             font-size: 18px;
             opacity: 0.7;
         }

         /* Improve selection highlighting */
         .mathquill-field .mq-selection {
             background: rgba(255, 107, 107, 0.2) !important;
             border-radius: 3px !important;
         }

         /* Add subtle animation when field becomes active */
         .mathquill-field.mq-focused {
             animation: focusGlow 0.3s ease-in-out;
         }

         @keyframes focusGlow {
             0% { box-shadow: 0 4px 12px rgba(50, 50, 50, 0.1); }
             50% { box-shadow: 0 0 25px rgba(255, 107, 107, 0.3); }
             100% { box-shadow: 0 0 15px rgba(255, 107, 107, 0.4); }
         }

         /* Input Label Styling */
         .input-label-container {
             background: linear-gradient(145deg, #f8fafc, #e2e8f0);
             border: 2px solid var(--main-color);
             border-radius: 10px;
             padding: 15px 20px;
             margin: 20px 0 10px 0;
             text-align: center;
             box-shadow: 0 2px 8px rgba(50, 50, 50, 0.1);
         }

         .input-label {
             font-size: 20px !important;
             font-weight: 600 !important;
             color: var(--font-color) !important;
             margin: 0 !important;
             text-align: center !important;
             background: linear-gradient(135deg, var(--accent-color), var(--tertiary-color));
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
             background-clip: text;
         }

         /* Input Section Container */
         .input-section {
             background: linear-gradient(145deg, #ffffff, #f8fafc);
            border: 2px solid var(--main-color);
            border-radius: 15px;
             padding: 25px;
             margin: 25px 0;
             box-shadow: 0 6px 20px rgba(50, 50, 50, 0.08);
         }

         .input-field-container {
            display: flex;
            justify-content: center;
             margin: 20px 0;
         }

         .button-group {
             display: flex;
             justify-content: center;
             gap: 15px;
             margin-top: 20px;
             flex-wrap: wrap;
         }

         .button-group button {
             flex: 0 0 auto;
             min-width: 120px;
         }



         .check-button, .hint-button {
             background: var(--tertiary-color);
            color: white;
             padding: 10px 20px;
             border: none;
             border-radius: 8px;
             cursor: pointer;
            font-weight: 600;
             margin: 10px 5px;
             transition: all 0.3s ease;
         }

         .check-button:hover, .hint-button:hover {
             background: #26a085;
             transform: translateY(-2px);
         }

         .feedback {
            padding: 15px;
             border-radius: 8px;
             margin: 15px 0;
            font-weight: 600;
             display: none;
         }

         .feedback.correct {
             background: #d4edda;
             color: #155724;
             border: 1px solid #c3e6cb;
         }

         .feedback.incorrect {
             background: #f8d7da;
             color: #721c24;
             border: 1px solid #f5c6cb;
         }

         .hint {
             background: #fff3cd;
             color: #856404;
             border: 1px solid #ffeaa7;
            padding: 15px;
             border-radius: 8px;
             margin: 15px 0;
             display: none;
         }



         .step-container {
             border: 2px solid #ddd;
             border-radius: 10px;
             margin: 15px 0;
             overflow: hidden;
        }

        .step-header {
             background: var(--secondary-color);
             padding: 15px;
             cursor: pointer;
             font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .step-content {
             padding: 20px;
             display: none;
             background: white;
         }

         .step-content.active {
             display: block;
         }

         .step-header:hover {
             background: #fed000;
         }

         .completed {
             background: var(--tertiary-color) !important;
            color: white;
         }

         .trophy {
             font-size: 2rem;
             color: #ffd700;
             margin: 0 10px;
         }

        /* Enhanced Responsive Design */
        @media screen and (max-width: 768px) {
            .sidebar {
            width: 100%;
                height: auto;
            position: relative;
                padding: 20px;
            }

            #main-content {
                margin-left: 0;
                padding: 10px;
            }

            .container {
                margin: 10px;
                padding: 15px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
                padding: 10px;
            }



            .step-container {
                margin: 10px 0;
            }

            .step-header {
                padding: 12px;
                font-size: 14px;
            }

            .step-content {
                padding: 15px;
            }

            .mathquill-field {
                min-height: 70px;
                font-size: 20px;
                padding: 18px 20px;
                max-width: 100%;
            }

            .mathquill-field .mq-editable-field {
                font-size: 20px !important;
                min-height: 35px !important;
            }

            .mathquill-field .mq-root-block {
                font-size: 20px !important;
            }

            .input-label-container {
                padding: 12px 15px;
                margin: 15px 0 8px 0;
            }

            .input-label {
                font-size: 18px !important;
            }

            .input-section {
                padding: 20px;
                margin: 20px 0;
            }

            .button-group {
                gap: 10px;
            }

            .button-group button {
                min-width: 100px;
                font-size: 14px;
                padding: 8px 12px;
            }

            .button {
                padding: 10px 15px;
                font-size: 14px;
                margin: 5px;
            }

            .definition-box, .example-box {
                padding: 20px;
                margin: 20px 0;
            }

            .practice-problem {
                padding: 15px;
                margin: 15px 0;
            }
        }

        @media screen and (max-width: 480px) {
            .container {
                margin: 5px;
                padding: 10px;
            }

            h1 {
                font-size: 1.8rem;
            }



            .step-header {
                flex-direction: column;
                text-align: center;
            }

            .mathquill-field {
                min-height: 60px;
                font-size: 18px;
                padding: 15px 18px;
            }

            .mathquill-field .mq-editable-field {
                font-size: 18px !important;
                min-height: 30px !important;
            }

            .mathquill-field .mq-root-block {
                font-size: 18px !important;
            }

            .input-label-container {
                padding: 10px 12px;
                margin: 12px 0 6px 0;
            }

            .input-label {
                font-size: 16px !important;
            }

            .input-section {
                padding: 15px;
                margin: 15px 0;
            }

            .button-group {
                flex-direction: column;
                gap: 8px;
            }

            .button-group button {
                width: 100%;
                min-width: auto;
                font-size: 14px;
                padding: 12px;
            }
        }

        /* Enhanced Interactive Elements */
        .interactive-demo {
            background: linear-gradient(145deg, #ffffff, #f1f3f4);
            border: 2px solid var(--main-color);
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(50, 50, 50, 0.08);
        }

        .interactive-demo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--tertiary-color), var(--secondary-color));
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .demo-btn {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            color: var(--font-color);
            border: 2px solid var(--main-color);
            border-radius: 12px;
            padding: 10px 18px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 3px 8px rgba(50, 50, 50, 0.1);
            position: relative;
            overflow: hidden;
        }

        .demo-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }

        .demo-btn:hover::before {
            left: 100%;
        }

        .demo-btn:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .demo-btn.active {
            background: var(--tertiary-color);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(29, 209, 161, 0.3);
        }

        .animated-formula {
            transition: all 0.3s ease;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            background: #f8f9fa;
        }

        .formula-highlight {
            background: rgba(255, 107, 107, 0.15);
            border: 2px solid var(--accent-color);
            animation: gentlePulse 3s ease-in-out infinite;
            transform: scale(1.02);
        }

        @keyframes gentlePulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.3);
                background: rgba(255, 107, 107, 0.15);
            }
            50% { 
                box-shadow: 0 0 0 8px rgba(255, 107, 107, 0);
                background: rgba(255, 107, 107, 0.25);
            }
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .step-dot.active {
            background: var(--tertiary-color);
            transform: scale(1.3);
        }

        .step-dot.completed {
            background: var(--secondary-color);
        }

        .floating-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .floating-help:hover {
            transform: scale(1.1);
            background: var(--tertiary-color);
        }

        .help-tooltip {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: white;
            border: 2px solid var(--main-color);
            border-radius: 10px;
            padding: 15px;
            width: 250px;
            box-shadow: var(--shadow-lg);
            display: none;
        }

        .help-tooltip.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Enhanced Feedback */
        .real-time-feedback {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
        }

        .feedback-correct {
            background: var(--tertiary-color);
            color: white;
        }

        .feedback-incorrect {
            background: var(--accent-color);
            color: white;
        }

        .feedback-typing {
            background: var(--secondary-color);
            color: var(--font-color);
        }

        /* Smooth transitions for all interactive elements */
        .mathquill-field, .step-container, .practice-problem, .interactive-section {
            transition: all 0.3s ease;
        }

        .mathquill-field:focus-within {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.2);
        }

        /* Touch-friendly enhancements */
        @media (hover: none) and (pointer: coarse) {
            .math-btn, .check-button, .hint-button, .demo-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .step-header {
                min-height: 60px;
            }
        }

        /* Popup Card Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            display: none;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .popup-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: white;
            border: 3px solid var(--main-color);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 2001;
            animation: popupSlideIn 0.4s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes popupSlideIn {
            from { 
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            to { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .popup-header {
            background: linear-gradient(135deg, var(--accent-color), var(--tertiary-color));
            color: white;
            padding: 20px 25px;
            border-radius: 17px 17px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .popup-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .popup-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            z-index: 1;
            position: relative;
        }

        .popup-close {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
            z-index: 1;
            position: relative;
        }

        .popup-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .popup-content {
            padding: 25px;
            line-height: 1.6;
        }

        .popup-section {
            margin-bottom: 25px;
                padding: 20px;
            background: linear-gradient(145deg, #f8f9fa, #ffffff);
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .popup-section h4 {
            color: var(--accent-color);
            margin: 0 0 15px 0;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .popup-section-icon {
            background: var(--accent-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
        }

        .popup-formula {
            background: #f0f8ff;
            border: 2px solid var(--tertiary-color);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.3rem;
            position: relative;
            overflow: hidden;
        }

        .popup-formula::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--tertiary-color), var(--secondary-color));
        }

        .popup-example {
            background: #fff9e6;
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .popup-tip {
            background: #e8f5e8;
            border: 2px solid var(--tertiary-color);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .popup-tip::before {
            content: '💡';
            position: absolute;
            top: -12px;
            left: 15px;
            background: var(--tertiary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 14px;
        }

        .popup-interactive {
            background: linear-gradient(145deg, #ffffff, #f1f3f4);
            border: 2px solid var(--main-color);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .popup-quiz {
            background: #f0f4ff;
            border: 2px solid #4285f4;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .quiz-question {
            font-weight: 600;
            margin-bottom: 15px;
            color: #1a73e8;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .quiz-option {
            background: white;
            border: 2px solid #e8eaed;
            border-radius: 8px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .quiz-option:hover {
            border-color: #4285f4;
            background: #f8f9ff;
        }

        .quiz-option.correct {
            border-color: var(--tertiary-color);
            background: #e8f5e8;
            color: #2e7d32;
        }

        .quiz-option.incorrect {
            border-color: var(--accent-color);
            background: #ffebee;
            color: #c62828;
        }

        .popup-tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
            gap: 5px;
        }

        .popup-tab {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #6c757d;
        }

        .popup-tab.active {
            background: white;
            color: var(--accent-color);
            border-color: var(--accent-color);
            transform: translateY(2px);
        }

        .popup-tab-content {
            display: none;
        }

        .popup-tab-content.active {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .popup-trigger {
            background: linear-gradient(145deg, var(--secondary-color), #fed000);
            color: var(--font-color);
            border: 2px solid var(--main-color);
            border-radius: 25px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
            box-shadow: 0 3px 10px rgba(254, 202, 87, 0.3);
        }

        .popup-trigger:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .popup-trigger-icon {
            font-size: 16px;
        }

        /* Responsive Design for Popups */
        @media screen and (max-width: 768px) {
            .popup-card {
                max-width: 95vw;
                max-height: 95vh;
                margin: 10px;
            }

            .popup-header {
                padding: 15px 20px;
            }

            .popup-title {
                font-size: 1.3rem;
            }

            .popup-content {
                padding: 20px;
            }

            .popup-section {
                padding: 15px;
                margin-bottom: 20px;
            }

            .popup-tabs {
                flex-wrap: wrap;
            }

            .popup-tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
                padding: 10px 15px;
                font-size: 14px;
            }

            .quiz-options {
                gap: 8px;
            }

            .quiz-option {
                padding: 10px 12px;
                font-size: 14px;
            }
        }

        @media screen and (max-width: 480px) {
            .popup-card {
                max-width: 98vw;
                max-height: 98vh;
                margin: 5px;
                border-radius: 15px;
            }

            .popup-header {
                padding: 12px 15px;
                border-radius: 12px 12px 0 0;
            }

            .popup-title {
                font-size: 1.2rem;
            }

            .popup-close {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }

            .popup-content {
                padding: 15px;
            }

            .popup-section {
                padding: 12px;
                margin-bottom: 15px;
            }

            .popup-section h4 {
                font-size: 1.1rem;
            }

            .popup-formula {
                padding: 15px;
                font-size: 1.1rem;
            }

            .popup-tab {
                padding: 8px 12px;
                font-size: 13px;
                min-width: 100px;
            }

            .popup-trigger {
                padding: 6px 12px;
                font-size: 13px;
                border-radius: 20px;
            }
        }

        /* Animation for popup triggers */
        .popup-trigger-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 3px 10px rgba(254, 202, 87, 0.3);
            }
            50% {
                box-shadow: 0 5px 20px rgba(254, 202, 87, 0.6);
                transform: translateY(-1px);
            }
            100% {
                box-shadow: 0 3px 10px rgba(254, 202, 87, 0.3);
            }
        }

        /* Enhanced Example Styles */
        .example-step {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .example-step-header {
            background: var(--secondary-color);
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--main-color);
        }

        .example-step-header:hover {
            background: #fed000;
        }

        .example-step-header.completed {
            background: var(--tertiary-color);
            color: white;
        }

        .example-step-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
        }

        .example-step-content.active {
                padding: 20px;
            max-height: 1000px;
        }

        .mistake-highlight {
            background: #ffebee;
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .mistake-highlight::before {
            content: "❌ Common Mistake";
            position: absolute;
            top: -12px;
            left: 15px;
            background: var(--accent-color);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .correct-highlight {
            background: #e8f5e8;
            border: 2px solid var(--tertiary-color);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .correct-highlight::before {
            content: "✓ Correct Method";
            position: absolute;
            top: -12px;
            left: 15px;
            background: var(--tertiary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .step-by-step-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: white;
            border: 2px solid var(--main-color);
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--tertiary-color);
            color: white;
        }

        .interactive-example {
            background: linear-gradient(145deg, #fff, #f8f9fa);
            border: 2px solid var(--main-color);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
        }

        .mistake-explanation {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .explanation-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            margin-right: 10px;
            font-size: 14px;
        }

        /* TryHackMe Style Format Guides */
        .tryhackme-guide {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border: 2px solid #334155;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            position: relative;
            overflow: hidden;
        }

        .tryhackme-guide::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
        }

        .guide-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #10b981;
            font-weight: bold;
        }

        .guide-icon {
            background: #10b981;
            color: #0f172a;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .answer-format {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .format-pattern {
            color: #fbbf24;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .format-example {
            color: #94a3b8;
            font-size: 14px;
            font-style: italic;
        }

        .character-counter {
            background: #374151;
            border: 1px solid #6b7280;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .char-count {
            color: #10b981;
            font-weight: bold;
        }

        .char-target {
            color: #94a3b8;
        }

        .progress-tracker {
            background: #111827;
            border: 2px solid #374151;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .progress-header {
            color: #10b981;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #374151;
            color: #e5e7eb;
        }

        .progress-item:last-child {
            border-bottom: none;
        }

        .progress-status {
            font-weight: bold;
        }

        .status-pending {
            color: #fbbf24;
        }

        .status-complete {
            color: #10b981;
        }

        .status-error {
            color: #ef4444;
        }

        .hint-system {
            background: #1f2937;
            border-left: 4px solid #3b82f6;
            border-radius: 0 8px 8px 0;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .hint-level {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: -8px;
            left: 15px;
        }

        .hint-content {
            color: #e5e7eb;
            margin-top: 8px;
            line-height: 1.5;
        }

        .terminal-style {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #333;
        }

        .terminal-prompt {
            color: #00ff00;
        }

        .terminal-output {
            color: #ffffff;
            margin-left: 20px;
        }

        .validation-feedback {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .length-hint {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 5px 0;
            color: #94a3b8;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .format-guide-container {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
        }

                 .format-guide-container::before {
             content: '🎯 ANSWER FORMAT';
             position: absolute;
             top: -12px;
             left: 20px;
             background: #10b981;
             color: #0f172a;
             padding: 4px 12px;
             border-radius: 15px;
             font-size: 12px;
             font-weight: bold;
         }

         /* Topic Completion Section */
         .topic-completion-section {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0, 0, 0, 0.8);
             z-index: 2000;
             display: flex;
             align-items: center;
             justify-content: center;
             backdrop-filter: blur(5px);
         }

         .completion-card {
             background: white;
             border: 3px solid #333;
             border-radius: 20px;
             max-width: 500px;
             width: 90%;
             padding: 0;
             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
             animation: slideInUp 0.5s ease;
         }

         @keyframes slideInUp {
             from {
                 transform: translateY(50px);
                 opacity: 0;
             }
             to {
                 transform: translateY(0);
                 opacity: 1;
             }
         }

         .completion-header {
             text-align: center;
             padding: 30px 30px 20px 30px;
             border-bottom: 2px solid #f0f0f0;
         }

         .completion-icon {
             font-size: 4rem;
             margin-bottom: 15px;
         }

         .completion-header h2 {
             color: #333;
             font-size: 1.8rem;
             margin: 0;
             font-weight: 700;
             background: none;
             padding: 0;
             border-radius: 0;
         }

         .completion-content {
             padding: 30px;
             text-align: center;
         }

         .completion-content p {
             color: #666;
             font-size: 1.1rem;
             margin-bottom: 25px;
             text-align: center;
         }

         .completion-stats {
             background: #f8f9fa;
             border-radius: 12px;
             padding: 20px;
             margin: 25px 0;
             text-align: left;
         }

         .stat-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 8px 0;
             border-bottom: 1px solid #e9ecef;
         }

         .stat-item:last-child {
             border-bottom: none;
         }

         .stat-label {
             font-weight: 600;
             color: #495057;
         }

         .stat-value {
             font-weight: 700;
             color: #333;
         }

         .complete-topic-btn {
             background: linear-gradient(135deg, #ff6b6b, #ff5252);
             color: white;
             border: none;
             border-radius: 12px;
             padding: 15px 30px;
             font-size: 1.1rem;
             font-weight: 700;
             cursor: pointer;
             transition: all 0.3s ease;
             box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
             width: 100%;
             max-width: 350px;
         }

         .complete-topic-btn:hover {
             background: linear-gradient(135deg, #ff5252, #f44336);
             transform: translateY(-2px);
             box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
         }

         .complete-topic-btn:active {
             transform: translateY(0);
         }

         /* Responsive Design for Completion */
         @media screen and (max-width: 768px) {
             .completion-card {
                 width: 95%;
                 margin: 10px;
             }

             .completion-header {
                 padding: 25px 20px 15px 20px;
             }

             .completion-header h2 {
                 font-size: 1.5rem;
             }

             .completion-content {
                 padding: 25px 20px;
             }

             .completion-icon {
                 font-size: 3rem;
             }

             .complete-topic-btn {
                 padding: 12px 25px;
                 font-size: 1rem;
            }
        }
    </style>
</head>
<body>

<div id="sidebar" class="sidebar">
  <a href="home.html">Home</a>
    <button class="dropdown-btn active">Derivatives
    <i class="fa fa-caret-down"></i>
  </button>
    <div class="dropdown-container" style="max-height: 300px;">
    <a href="The_definition_of_derivative.html" class="active">Definition of Derivative</a>
    <a href="rule.html">Differentiation Rules</a>
    <a href="Equation-of-tangent.html">Equation of Tangent</a>
    <a href="Second-derivative.html">Second Derivative</a>
    <a href="Implicit-differentiation.html">Implicit Differentiation</a>
  </div>
</div>

<div id="main-content" style="margin-left:260px;margin-top:20px;">
    
        <div class="container">
        <h1>2.2 The Definition of Derivative</h1>
        
        <!-- Interactive Definition Section -->
        <div class="definition-box">
            <h2>📚 Definition</h2>
            <p>The derivative of \(f(x)\) with respect to \(x\) is the function \(f'(x)\) and is defined as,</p>
            <div class="animated-formula" id="main-formula">
                \[f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                    </div>
            
            <!-- Popup Triggers -->
            <div style="text-align: center; margin: 20px 0;">
                <button class="popup-trigger popup-trigger-pulse" onclick="openPopup('definition-popup')">
                    <span class="popup-trigger-icon">📖</span>
                    Learn More About This Definition
                </button>
                <button class="popup-trigger" onclick="openPopup('notation-popup')">
                    <span class="popup-trigger-icon">📝</span>
                    Notation Guide
                </button>
                <button class="popup-trigger" onclick="openPopup('intuition-popup')">
                    <span class="popup-trigger-icon">💡</span>
                    Intuitive Understanding
                </button>
            </div>
            
            <!-- Interactive Formula Explorer -->
            <div class="interactive-demo">
                <h3>🔍 Explore the Formula Components</h3>
                <p>Click on each part to understand what it means:</p>
                <div class="demo-controls">
                    <button class="demo-btn" onclick="highlightComponent('derivative')">f'(x)</button>
                    <button class="demo-btn" onclick="highlightComponent('limit')">lim h→0</button>
                    <button class="demo-btn" onclick="highlightComponent('difference')">f(x+h) - f(x)</button>
                    <button class="demo-btn" onclick="highlightComponent('increment')">h</button>
                    <button class="demo-btn" onclick="highlightComponent('reset')">Reset</button>
                </div>
                <div id="component-explanation" style="min-height: 60px; padding: 15px; background: white; border-radius: 8px; margin-top: 10px;">
                    <p><em>Click on any component above to see its explanation!</em></p>
                </div>
            </div>
                </div>
                
        <!-- Equivalent Notations -->
        <div class="example-box">
            <p>Given a function \(y = f(x)\), all of the following are equivalent and represent the derivative of \(f(x)\) with respect to \(x\).</p>
            <div class="math-expression">
                \[f'(x) = \frac{dy}{dx} = y'\]
            </div>
                </div>
                
        <!-- Tip Box -->
        <div class="tip-box">
            <div class="tip-icon">Tip</div>
            <ol>
                <li>\(f'(x)\) is read as "f prime of x".</li>
                <li>\(\frac{dy}{dx}\) is read as "derivative of y with respect to x".</li>
            </ol>
                </div>

        <!-- Interactive Example 1 -->
        <div class="interactive-example">
            <div class="example-title">📖 Interactive Example 1</div>
            <p><strong>(Derivative of a polynomial function)</strong></p>
            <p>Given \(f(x) = 3x^2 - x\). Use the definition of derivative to find \(f'(x)\).</p>
            
            <!-- Popup Triggers for Example 1 -->
            <div style="text-align: center; margin: 15px 0;">
                <button class="popup-trigger" onclick="openPopup('polynomial-tips-popup')">
                    <span class="popup-trigger-icon">🎯</span>
                    Polynomial Tips
                </button>
                <button class="popup-trigger" onclick="openPopup('common-mistakes-popup')">
                    <span class="popup-trigger-icon">⚠️</span>
                    Avoid Common Mistakes
                </button>
                <button class="popup-trigger" onclick="openPopup('step-by-step-popup')">
                    <span class="popup-trigger-icon">📋</span>
                    Quick Reference
                </button>
            </div>
            
            <!-- Step Navigation -->
            <div class="step-by-step-nav">
                <button class="nav-btn active" onclick="showExampleStep('ex1', 1)">Step 1: Setup</button>
                <button class="nav-btn" onclick="showExampleStep('ex1', 2)">Step 2: f(x+h)</button>
                <button class="nav-btn" onclick="showExampleStep('ex1', 3)">Step 3: Expand</button>
                <button class="nav-btn" onclick="showExampleStep('ex1', 4)">Step 4: Subtract</button>
                <button class="nav-btn" onclick="showExampleStep('ex1', 5)">Step 5: Factor</button>
                <button class="nav-btn" onclick="showExampleStep('ex1', 6)">Step 6: Limit</button>
                <button class="nav-btn" onclick="showExampleStep('ex1', 'mistakes')">Common Mistakes</button>
            </div>

            <!-- Step 1: Setup -->
            <div class="example-step" id="ex1-step1">
                <div class="example-step-header" onclick="toggleExampleStep('ex1', 1)">
                    <span>Step 1: Apply the Definition</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content active">
                    <p>We start with the definition of derivative:</p>
                <div class="math-expression">
                    \[f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                </div>
                    <p>Given: \(f(x) = 3x^2 - x\)</p>
                    
                    <div class="tip-box">
                        <div class="tip-icon">💡</div>
                        <p>Always write out the definition first - this helps you remember what to find next!</p>
                    </div>
                </div>
                    </div>
                    
            <!-- Step 2: Find f(x+h) -->
            <div class="example-step" id="ex1-step2">
                <div class="example-step-header" onclick="toggleExampleStep('ex1', 2)">
                    <span>Step 2: Find f(x+h)</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <p>Substitute \((x+h)\) for every \(x\) in the original function:</p>
                <div class="math-expression">
                        \[f(x+h) = 3(x+h)^2 - (x+h)\]
                    </div>
                    
                    <div class="mistake-highlight">
                        <p><strong>❌ WRONG:</strong> \(f(x+h) = 3x^2 + h - x + h\)</p>
                        <p>Students often just add \(h\) to each term instead of substituting!</p>
                    </div>
                
                    <div class="correct-highlight">
                        <p><strong>✓ CORRECT:</strong> Replace every \(x\) with \((x+h)\)</p>
                        <p>\(3x^2 \rightarrow 3(x+h)^2\) and \(x \rightarrow (x+h)\)</p>
                    </div>
                </div>
            </div>

            <!-- Step 3: Expand -->
            <div class="example-step" id="ex1-step3">
                <div class="example-step-header" onclick="toggleExampleStep('ex1', 3)">
                    <span>Step 3: Expand f(x+h)</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <p>Expand \((x+h)^2\) using the formula \((a+b)^2 = a^2 + 2ab + b^2\):</p>
                <div class="math-expression">
                        \[(x+h)^2 = x^2 + 2xh + h^2\]
                    </div>
                    <p>So:</p>
                    <div class="math-expression">
                        \[f(x+h) = 3(x^2 + 2xh + h^2) - (x+h)\]
                        \[= 3x^2 + 6xh + 3h^2 - x - h\]
                    </div>
                    
                    <div class="mistake-highlight">
                        <p><strong>❌ WRONG:</strong> \((x+h)^2 = x^2 + h^2\)</p>
                        <p>Don't forget the middle term \(2xh\)!</p>
                    </div>
                </div>
            </div>

            <!-- Step 4: Subtract -->
            <div class="example-step" id="ex1-step4">
                <div class="example-step-header" onclick="toggleExampleStep('ex1', 4)">
                    <span>Step 4: Calculate f(x+h) - f(x)</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                <div class="math-expression">
                        \[f(x+h) - f(x) = [3x^2 + 6xh + 3h^2 - x - h] - [3x^2 - x]\]
                    </div>
                    <div class="math-expression">
                        \[= 3x^2 + 6xh + 3h^2 - x - h - 3x^2 + x\]
                    </div>
                    <div class="math-expression">
                        \[= 6xh + 3h^2 - h\]
                        </div>
                        
                    <div class="tip-box">
                        <div class="tip-icon">✨</div>
                        <p>Notice how the \(3x^2\) terms and \(x\) terms cancel out! This always happens.</p>
                    </div>
                    
                    <div class="mistake-highlight">
                        <p><strong>❌ WRONG:</strong> Forgetting to distribute the negative sign</p>
                        <p>\(- [3x^2 - x] \neq -3x^2 - x\)</p>
                        <p>It should be \(-3x^2 + x\)</p>
                    </div>
                </div>
            </div>

            <!-- Step 5: Factor -->
            <div class="example-step" id="ex1-step5">
                <div class="example-step-header" onclick="toggleExampleStep('ex1', 5)">
                    <span>Step 5: Factor and Simplify</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <p>Factor out \(h\) from the numerator:</p>
                <div class="math-expression">
                        \[\frac{f(x+h) - f(x)}{h} = \frac{6xh + 3h^2 - h}{h}\]
                    </div>
                    <div class="math-expression">
                        \[= \frac{h(6x + 3h - 1)}{h}\]
                    </div>
                    <div class="math-expression">
                        \[= 6x + 3h - 1\]
                </div>
                
                    <div class="mistake-highlight">
                        <p><strong>❌ WRONG:</strong> Canceling \(h\) before factoring</p>
                        <p>You can't cancel \(h\) in \(\frac{6xh + 3h^2 - h}{h}\) term by term!</p>
                        <p>Must factor first: \(\frac{h(6x + 3h - 1)}{h}\)</p>
                            </div>
                </div>
                        </div>
                        
            <!-- Step 6: Limit -->
            <div class="example-step" id="ex1-step6">
                <div class="example-step-header" onclick="toggleExampleStep('ex1', 6)">
                    <span>Step 6: Apply the Limit</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                <div class="math-expression">
                        \[f'(x) = \lim_{h \to 0} (6x + 3h - 1)\]
                        </div>
                    <div class="math-expression">
                        \[= 6x + 3(0) - 1\]
                    </div>
                    <div class="math-expression">
                        \[= 6x - 1\]
                </div>
                
                    <div class="correct-highlight">
                        <p><strong>✓ Final Answer:</strong> \(f'(x) = 6x - 1\)</p>
                    </div>
                    
                    <div class="tip-box">
                        <div class="tip-icon">🎯</div>
                        <p>Check: The derivative of \(3x^2\) is \(6x\) and the derivative of \(-x\) is \(-1\). This matches our answer!</p>
                    </div>
                </div>
            </div>

            <!-- Common Mistakes Summary -->
            <div class="example-step" id="ex1-mistakes">
                <div class="example-step-header" onclick="toggleExampleStep('ex1', 'mistakes')">
                    <span>🚨 Common Student Mistakes</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <div class="comparison-container">
                        <div class="mistake-highlight">
                            <h4>❌ Mistake 1: Wrong Substitution</h4>
                            <p>\(f(x+h) = 3x^2 + h - x + h\)</p>
                            <p><em>Adding h to each term instead of substituting</em></p>
                        </div>
                        <div class="correct-highlight">
                            <h4>✓ Correct: Complete Substitution</h4>
                            <p>\(f(x+h) = 3(x+h)^2 - (x+h)\)</p>
                            <p><em>Replace every x with (x+h)</em></p>
                        </div>
                    </div>
                    
                    <div class="comparison-container">
                        <div class="mistake-highlight">
                            <h4>❌ Mistake 2: Expanding Squares</h4>
                            <p>\((x+h)^2 = x^2 + h^2\)</p>
                            <p><em>Forgetting the middle term</em></p>
                        </div>
                        <div class="correct-highlight">
                            <h4>✓ Correct: Complete Expansion</h4>
                            <p>\((x+h)^2 = x^2 + 2xh + h^2\)</p>
                            <p><em>Don't forget 2xh!</em></p>
                        </div>
                    </div>

                    <div class="comparison-container">
                        <div class="mistake-highlight">
                            <h4>❌ Mistake 3: Canceling Too Early</h4>
                            <p>\(\frac{6xh + 3h^2 - h}{h} = 6x + 3h\)</p>
                            <p><em>Can't cancel h term by term</em></p>
                        </div>
                        <div class="correct-highlight">
                            <h4>✓ Correct: Factor First</h4>
                            <p>\(\frac{h(6x + 3h - 1)}{h} = 6x + 3h - 1\)</p>
                            <p><em>Factor out h first, then cancel</em></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                
        <!-- Interactive Example 2 -->
        <div class="interactive-example">
            <div class="example-title">📖 Interactive Example 2</div>
            <p><strong>(Derivative of a rational function)</strong></p>
            <p>Find the derivative of \(y = \frac{x}{1-3x}\) by using first principle of differentiation.</p>
            
            <!-- Step Navigation -->
            <div class="step-by-step-nav">
                <button class="nav-btn active" onclick="showExampleStep('ex2', 1)">Step 1: Setup</button>
                <button class="nav-btn" onclick="showExampleStep('ex2', 2)">Step 2: f(x+h)</button>
                <button class="nav-btn" onclick="showExampleStep('ex2', 3)">Step 3: Subtract</button>
                <button class="nav-btn" onclick="showExampleStep('ex2', 4)">Step 4: Common Denominator</button>
                <button class="nav-btn" onclick="showExampleStep('ex2', 5)">Step 5: Expand</button>
                <button class="nav-btn" onclick="showExampleStep('ex2', 6)">Step 6: Simplify</button>
                <button class="nav-btn" onclick="showExampleStep('ex2', 7)">Step 7: Limit</button>
                <button class="nav-btn" onclick="showExampleStep('ex2', 'mistakes')">Common Mistakes</button>
            </div>

            <!-- Step 1: Setup -->
            <div class="example-step" id="ex2-step1">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 1)">
                    <span>Step 1: Apply the Definition</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content active">
                <p>Let \(f(x) = \frac{x}{1-3x}\)</p>
                    <div class="math-expression">
                        \[\frac{dy}{dx} = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                    </div>
                    
                    <div class="tip-box">
                        <div class="tip-icon">💡</div>
                        <p>Rational functions require careful handling of fractions. We'll need to find a common denominator!</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: Find f(x+h) -->
            <div class="example-step" id="ex2-step2">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 2)">
                    <span>Step 2: Find f(x+h)</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <p>Substitute \((x+h)\) for every \(x\) in the rational function:</p>
                <div class="math-expression">
                        \[f(x+h) = \frac{x+h}{1-3(x+h)}\]
                </div>
                
                    <div class="mistake-highlight">
                        <p><strong>❌ WRONG:</strong> \(f(x+h) = \frac{x+h}{1-3x+h}\)</p>
                        <p>Remember: \(1-3(x+h) = 1-3x-3h\), not \(1-3x+h\)!</p>
                    </div>
                    
                    <div class="correct-highlight">
                        <p><strong>✓ CORRECT:</strong> \(f(x+h) = \frac{x+h}{1-3x-3h}\)</p>
                        <p>Distribute the -3 to both x and h</p>
                    </div>
                </div>
            </div>

            <!-- Step 3: Subtract -->
            <div class="example-step" id="ex2-step3">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 3)">
                    <span>Step 3: Calculate f(x+h) - f(x)</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                <div class="math-expression">
                        \[f(x+h) - f(x) = \frac{x+h}{1-3(x+h)} - \frac{x}{1-3x}\]
            </div>
                
                    <div class="mistake-explanation">
                        <span class="explanation-icon" style="background: #ff9800; color: white;">⚠</span>
                        <strong>Challenge:</strong> We have two fractions with different denominators. We need a common denominator to subtract them!
                    </div>
                </div>
            </div>

            <!-- Step 4: Common Denominator -->
            <div class="example-step" id="ex2-step4">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 4)">
                    <span>Step 4: Create Common Denominator</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <p>The common denominator is \([1-3(x+h)][1-3x]\):</p>
                <div class="math-expression">
                        \[\frac{x+h}{1-3(x+h)} - \frac{x}{1-3x} = \frac{(x+h)(1-3x) - x[1-3(x+h)]}{[1-3(x+h)][1-3x]}\]
                        </div>
                        
                    <div class="mistake-highlight">
                        <p><strong>❌ WRONG:</strong> Just multiplying denominators without adjusting numerators</p>
                        <p>If you change the denominator, you must change the numerator too!</p>
                    </div>
                    
                    <div class="tip-box">
                        <div class="tip-icon">🔧</div>
                        <p>Remember: \(\frac{a}{b} - \frac{c}{d} = \frac{ad - bc}{bd}\)</p>
                    </div>
                </div>
            </div>

            <!-- Step 5: Expand -->
            <div class="example-step" id="ex2-step5">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 5)">
                    <span>Step 5: Expand the Numerator</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <p>Expand \((x+h)(1-3x)\) and \(x[1-3(x+h)]\):</p>
                <div class="math-expression">
                        \[(x+h)(1-3x) = x - 3x^2 + h - 3hx\]
                    </div>
                    <div class="math-expression">
                        \[x[1-3(x+h)] = x[1-3x-3h] = x - 3x^2 - 3hx\]
                    </div>
                    
                    <p>So the numerator becomes:</p>
                <div class="math-expression">
                        \[(x - 3x^2 + h - 3hx) - (x - 3x^2 - 3hx)\]
                        \[= x - 3x^2 + h - 3hx - x + 3x^2 + 3hx\]
                        \[= h\]
                    </div>
                    
                    <div class="tip-box">
                        <div class="tip-icon">✨</div>
                        <p>Notice how most terms cancel out, leaving only \(h\)! This is typical for rational functions.</p>
                    </div>
                </div>
            </div>

            <!-- Step 6: Simplify -->
            <div class="example-step" id="ex2-step6">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 6)">
                    <span>Step 6: Simplify the Expression</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <p>Now we have:</p>
                <div class="math-expression">
                        \[\frac{f(x+h) - f(x)}{h} = \frac{h}{h[1-3(x+h)][1-3x]} = \frac{1}{[1-3(x+h)][1-3x]}\]
                </div>
                
                    <div class="mistake-highlight">
                        <p><strong>❌ WRONG:</strong> Forgetting to include \(h\) in the denominator</p>
                        <p>The definition requires dividing by \(h\), so we have \(h\) in both numerator and denominator.</p>
                    </div>
                </div>
            </div>

            <!-- Step 7: Limit -->
            <div class="example-step" id="ex2-step7">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 7)">
                    <span>Step 7: Apply the Limit</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                <div class="math-expression">
                        \[\frac{dy}{dx} = \lim_{h \to 0} \frac{1}{[1-3(x+h)][1-3x]}\]
                </div>
                    <div class="math-expression">
                        \[= \frac{1}{[1-3(x+0)][1-3x]} = \frac{1}{(1-3x)(1-3x)}\]
                    </div>
                    <div class="math-expression">
                        \[= \frac{1}{(1-3x)^2}\]
                    </div>
                    
                    <div class="correct-highlight">
                        <p><strong>✓ Final Answer:</strong> \(\frac{dy}{dx} = \frac{1}{(1-3x)^2}\)</p>
                    </div>
                    
                    <div class="tip-box">
                        <div class="tip-icon">🎯</div>
                        <p>Check: Using the quotient rule, \(\frac{d}{dx}[\frac{x}{1-3x}] = \frac{(1-3x) \cdot 1 - x \cdot (-3)}{(1-3x)^2} = \frac{1-3x+3x}{(1-3x)^2} = \frac{1}{(1-3x)^2}\) ✓</p>
                    </div>
                </div>
            </div>

            <!-- Common Mistakes Summary -->
            <div class="example-step" id="ex2-mistakes">
                <div class="example-step-header" onclick="toggleExampleStep('ex2', 'mistakes')">
                    <span>🚨 Common Student Mistakes</span>
                    <span>▼</span>
                </div>
                <div class="example-step-content">
                    <div class="comparison-container">
                        <div class="mistake-highlight">
                            <h4>❌ Mistake 1: Wrong Substitution in Denominator</h4>
                            <p>\(1-3(x+h) = 1-3x+h\)</p>
                            <p><em>Not distributing the -3 properly</em></p>
                        </div>
                        <div class="correct-highlight">
                            <h4>✓ Correct: Distribute Carefully</h4>
                            <p>\(1-3(x+h) = 1-3x-3h\)</p>
                            <p><em>-3 multiplies both x and h</em></p>
                        </div>
                    </div>
                    
                    <div class="comparison-container">
                        <div class="mistake-highlight">
                            <h4>❌ Mistake 2: Improper Fraction Subtraction</h4>
                            <p>\(\frac{a}{b} - \frac{c}{d} = \frac{a-c}{b-d}\)</p>
                            <p><em>You can't subtract denominators!</em></p>
                        </div>
                        <div class="correct-highlight">
                            <h4>✓ Correct: Common Denominator Method</h4>
                            <p>\(\frac{a}{b} - \frac{c}{d} = \frac{ad-bc}{bd}\)</p>
                            <p><em>Find common denominator first</em></p>
                        </div>
                    </div>

                    <div class="comparison-container">
                        <div class="mistake-highlight">
                            <h4>❌ Mistake 3: Algebraic Expansion Errors</h4>
                            <p>\((x+h)(1-3x) = x + h - 3x^2\)</p>
                            <p><em>Missing the -3hx term</em></p>
                        </div>
                        <div class="correct-highlight">
                            <h4>✓ Correct: Complete FOIL</h4>
                            <p>\((x+h)(1-3x) = x - 3x^2 + h - 3hx\)</p>
                            <p><em>Don't forget cross terms!</em></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tip Box for Differentiation -->
        <div class="tip-box">
            <div class="tip-icon">Tip</div>
            <ol>
                <li>\(f(x)\) → differentiate → \(f'(x)\)</li>
                <li>\(y\) → differentiate → \(\frac{dy}{dx}\)</li>
            </ol>
        </div>

        <!-- Example 3 -->
        <div class="example-box">
            <div class="example-title">Example 3</div>
            <p><strong>(Derivative of a radical function)</strong></p>
            <p>Given \(f(x) = \sqrt{2x-1}\). Find \(f'(x)\) using the definition of derivative.</p>
            
            <div class="solution-steps">
                <h3>Solution</h3>
                <p>\(f(x) = \sqrt{2x-1}\)</p>
                <p>\(f(x + h) = \sqrt{2(x + h)-1}\)</p>
                
                <div class="math-expression">
                    \[f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                    </div>
                    
                <div class="math-expression">
                    \[= \lim_{h \to 0} \frac{\sqrt{2(x + h)-1} - \sqrt{2x-1}}{h}\]
                        </div>
                        
                <div class="math-expression">
                    \[= \lim_{h \to 0} \frac{\sqrt{2(x + h)-1} - \sqrt{2x-1}}{h} \cdot \frac{\sqrt{2(x + h)-1} + \sqrt{2x-1}}{\sqrt{2(x + h)-1} + \sqrt{2x-1}}\]
                            </div>
                            
                <div class="math-expression">
                    \[= \lim_{h \to 0} \frac{[2(x + h)-1] - [2x-1]}{h[\sqrt{2(x + h)-1} + \sqrt{2x-1}]}\]
                            </div>
                            
                <div class="math-expression">
                    \[= \lim_{h \to 0} \frac{2x + 2h - 1 - 2x + 1}{h[\sqrt{2(x + h)-1} + \sqrt{2x-1}]}\]
                    </div>
                    
                <div class="math-expression">
                    \[= \lim_{h \to 0} \frac{2h}{h[\sqrt{2(x + h)-1} + \sqrt{2x-1}]}\]
                            </div>
                            
                <div class="math-expression">
                    \[= \lim_{h \to 0} \frac{2}{\sqrt{2(x + h)-1} + \sqrt{2x-1}}\]
                        </div>
                        
                <div class="math-expression">
                    \[= \frac{2}{\sqrt{2(x + 0)-1} + \sqrt{2x-1}} = \frac{2}{\sqrt{2x-1} + \sqrt{2x-1}} = \frac{2}{2\sqrt{2x-1}} = \frac{1}{\sqrt{2x-1}}\]
                            </div>
                        </div>
                        </div>
                        
        <!-- Important Warning -->
        <div class="warning-box">
            <div class="warning-icon">⚠</div>
            <div>
                <p><strong>We only use this method (Definition of Derivative) if it is required by the question.</strong></p>
                <p><strong>Example:</strong></p>
                <p>"... by using the definition of derivative."</p>
                <p>"Use the definition of derivative to ..."</p>
                    </div>
                </div>
                
        

         <!-- Interactive Practice Section -->
         <div class="interactive-section">
             <h2>🎯 Interactive Practice: Apply the Definition</h2>
             <p>Now it's your turn! Try solving this step-by-step with guidance.</p>
             
             <!-- TryHackMe Style Progress Tracker -->
             <div class="progress-tracker">
                 <div class="progress-header">
                     <span>📊</span> Task Progress
                 </div>
                 <div class="progress-item">
                     <span>Step 1: Set up f(x+h)</span>
                     <span class="progress-status status-pending" id="progress-step1">PENDING</span>
                 </div>
                 <div class="progress-item">
                     <span>Step 2: Expand expression</span>
                     <span class="progress-status status-pending" id="progress-step2">PENDING</span>
                 </div>
                 <div class="progress-item">
                     <span>Step 3: Calculate difference</span>
                     <span class="progress-status status-pending" id="progress-step3">PENDING</span>
                 </div>
                 <div class="progress-item">
                     <span>Step 4: Apply limit</span>
                     <span class="progress-status status-pending" id="progress-step4">PENDING</span>
                 </div>
             </div>
             

             
             <!-- Practice Popup Triggers -->
             <div style="text-align: center; margin: 15px 0;">
                 <button class="popup-trigger" onclick="openPopup('practice-guide-popup')">
                     <span class="popup-trigger-icon">🎓</span>
                     Practice Guide
                 </button>
                 <button class="popup-trigger" onclick="openPopup('formula-reference-popup')">
                     <span class="popup-trigger-icon">📐</span>
                     Formula Reference
                 </button>
                 <button class="popup-trigger" onclick="openPopup('calculator-popup')">
                     <span class="popup-trigger-icon">🧮</span>
                     Step Calculator
                 </button>
             </div>
             
             <!-- Step Indicator -->
             <div class="step-indicator">
                 <div class="step-dot active" onclick="jumpToStep(1)" title="Step 1"></div>
                 <div class="step-dot" onclick="jumpToStep(2)" title="Step 2"></div>
                 <div class="step-dot" onclick="jumpToStep(3)" title="Step 3"></div>
                 <div class="step-dot" onclick="jumpToStep(4)" title="Step 4"></div>
             </div>
             
             <div class="practice-problem">
                 <h3>Practice Problem</h3>
                 <p>Find the derivative of \(f(x) = 2x^2 + 3x\) using the definition of derivative.</p>
                 
                 <div class="step-by-step">
                     <div class="step-container">
                         <div class="step-header" onclick="toggleStep(1)">
                             <span>Step 1: Set up f(x + h)</span>
                             <span>▼</span>
                    </div>
                         <div class="step-content" id="step1">
                             <p>First, let's find \(f(x + h)\) where \(f(x) = 2x^2 + 3x\).</p>
                             
                             <!-- TryHackMe Style Format Guide -->
                             <div class="format-guide-container">
                                 <div class="answer-format">
                                     <div class="format-pattern">Expected Format: _(_+_)^_ + _(_+_)</div>
                                     <div class="format-example">Example: 2(x+h)^2 + 3(x+h)</div>
                                 </div>
                                 <div class="character-counter">
                                     <span>Character Count: <span class="char-count" id="step1-count">0</span></span>
                                     <span class="char-target">Target: ~15-20 chars</span>
                                 </div>
                                 <div class="length-hint">💡 Hint: Replace every 'x' with '(x+h)'</div>
                             </div>
                             
                             <div class="input-section">
                                 <div class="input-label-container">
                                     <p class="input-label">Enter your answer for \(f(x + h)\):</p>
                                 </div>
                             
                                 <div class="input-field-container">
                                     <div class="mathquill-field" id="step1-input">
                                         <div class="real-time-feedback" id="step1-realtime"></div>
                                     </div>
                                 </div>
                                 
                                 <div class="button-group">
                             <button class="check-button" onclick="checkStep1()">Check Answer</button>
                             <button class="hint-button" onclick="showAdvancedHint(1, 1)">Hint Level 1</button>
                             <button class="hint-button" onclick="showAdvancedHint(1, 2)">Hint Level 2</button>
                             <button class="hint-button" onclick="showAdvancedHint(1, 3)">Show Solution</button>
                                 </div>
                             </div>
                             
                             <div class="feedback" id="step1-feedback"></div>
                             
                             <!-- Advanced Hint System -->
                             <div class="hint-system" id="hint1-level1" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 1</div>
                                 <div class="hint-content">Think about substitution: What happens when you replace every 'x' in the original function?</div>
                                        </div>
                             
                             <div class="hint-system" id="hint1-level2" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 2</div>
                                 <div class="hint-content">For f(x) = 2x² + 3x, substitute (x+h) for x: f(x+h) = 2(x+h)² + 3(x+h)</div>
                             </div>
                             
                             <div class="hint-system" id="hint1-level3" style="display: none;">
                                 <div class="hint-level">SOLUTION</div>
                                 <div class="hint-content">f(x+h) = 2(x+h)² + 3(x+h) - This is the complete substitution where every x becomes (x+h)</div>
                             </div>
                                    </div>
                                </div>

                     <div class="step-container">
                         <div class="step-header" onclick="toggleStep(2)">
                             <span>Step 2: Expand f(x + h)</span>
                             <span>▼</span>
                                        </div>
                         <div class="step-content" id="step2">
                             <p>Now expand \(f(x + h) = 2(x + h)^2 + 3(x + h)\).</p>
                             
                             <!-- TryHackMe Style Format Guide -->
                             <div class="format-guide-container">
                                 <div class="answer-format">
                                     <div class="format-pattern">Expected Format: _x^_ + _xh + _h^_ + _x + _h</div>
                                     <div class="format-example">Example: 2x^2 + 4xh + 2h^2 + 3x + 3h</div>
                                 </div>
                                 <div class="character-counter">
                                     <span>Character Count: <span class="char-count" id="step2-count">0</span></span>
                                     <span class="char-target">Target: ~25-30 chars</span>
                                 </div>
                                 <div class="length-hint">💡 Remember: (x+h)² = x² + 2xh + h²</div>
                                </div>

                             <div class="input-section">
                                 <div class="input-label-container">
                                     <p class="input-label">Enter the expanded form:</p>
                                 </div>

                                 <div class="input-field-container">
                                     <div class="mathquill-field" id="step2-input">
                                         <div class="real-time-feedback" id="step2-realtime"></div>
                                     </div>
                                 </div>
                                 
                                 <div class="button-group">
                             <button class="check-button" onclick="checkStep2()">Check Answer</button>
                             <button class="hint-button" onclick="showAdvancedHint(2, 1)">Hint Level 1</button>
                             <button class="hint-button" onclick="showAdvancedHint(2, 2)">Hint Level 2</button>
                             <button class="hint-button" onclick="showAdvancedHint(2, 3)">Show Solution</button>
                                 </div>
                             </div>
                             
                             <div class="feedback" id="step2-feedback"></div>
                             
                             <!-- Advanced Hint System -->
                             <div class="hint-system" id="hint2-level1" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 1</div>
                                 <div class="hint-content">Use the binomial expansion formula: (a+b)² = a² + 2ab + b²</div>
                                        </div>
                             
                             <div class="hint-system" id="hint2-level2" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 2</div>
                                 <div class="hint-content">2(x+h)² = 2(x² + 2xh + h²) = 2x² + 4xh + 2h², and 3(x+h) = 3x + 3h</div>
                             </div>
                             
                             <div class="hint-system" id="hint2-level3" style="display: none;">
                                 <div class="hint-level">SOLUTION</div>
                                 <div class="hint-content">2x² + 4xh + 2h² + 3x + 3h - Complete expansion with all terms</div>
                             </div>
                                    </div>
                                </div>

                     <div class="step-container">
                         <div class="step-header" onclick="toggleStep(3)">
                             <span>Step 3: Calculate f(x + h) - f(x)</span>
                             <span>▼</span>
                                        </div>
                         <div class="step-content" id="step3">
                             <p>Calculate \(f(x + h) - f(x)\) where:</p>
                             <p>\(f(x + h) = 2x^2 + 4xh + 2h^2 + 3x + 3h\)</p>
                             <p>\(f(x) = 2x^2 + 3x\)</p>
                             
                             <!-- TryHackMe Style Format Guide -->
                             <div class="format-guide-container">
                                 <div class="answer-format">
                                     <div class="format-pattern">Expected Format: _xh + _h^_ + _h</div>
                                     <div class="format-example">Example: 4xh + 2h^2 + 3h</div>
                                 </div>
                                 <div class="character-counter">
                                     <span>Character Count: <span class="char-count" id="step3-count">0</span></span>
                                     <span class="char-target">Target: ~15-18 chars</span>
                                 </div>
                                 <div class="length-hint">💡 The constant terms should cancel out!</div>
                    </div>

                             <div class="input-section">
                                 <div class="input-label-container">
                                     <p class="input-label">Enter your result:</p>
                                 </div>

                                 <div class="input-field-container">
                                     <div class="mathquill-field" id="step3-input">
                                         <div class="real-time-feedback" id="step3-realtime"></div>
                                     </div>
                                 </div>
                                 
                                 <div class="button-group">
                             <button class="check-button" onclick="checkStep3()">Check Answer</button>
                             <button class="hint-button" onclick="showAdvancedHint(3, 1)">Hint Level 1</button>
                             <button class="hint-button" onclick="showAdvancedHint(3, 2)">Hint Level 2</button>
                             <button class="hint-button" onclick="showAdvancedHint(3, 3)">Show Solution</button>
                                 </div>
                             </div>
                             
                             <div class="feedback" id="step3-feedback"></div>
                             
                             <!-- Advanced Hint System -->
                             <div class="hint-system" id="hint3-level1" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 1</div>
                                 <div class="hint-content">Subtract f(x) from f(x+h). Which terms will cancel out?</div>
                                            </div>
                             
                             <div class="hint-system" id="hint3-level2" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 2</div>
                                 <div class="hint-content">The 2x² and 3x terms appear in both expressions, so they cancel: (2x² + 4xh + 2h² + 3x + 3h) - (2x² + 3x)</div>
                             </div>
                             
                             <div class="hint-system" id="hint3-level3" style="display: none;">
                                 <div class="hint-level">SOLUTION</div>
                                 <div class="hint-content">4xh + 2h² + 3h - Only the terms with h remain after cancellation</div>
                             </div>
                                    </div>
                                </div>

                     <div class="step-container">
                         <div class="step-header" onclick="toggleStep(4)">
                             <span>Step 4: Final Answer - Apply the Limit</span>
                             <span>▼</span>
                                        </div>
                         <div class="step-content" id="step4">
                             <p>Now apply the limit: \(\lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\)</p>
                             <p>From Step 3, we have \(f(x+h) - f(x) = 4xh + 2h^2 + 3h\)</p>
                             
                             <!-- TryHackMe Style Format Guide -->
                             <div class="format-guide-container">
                                 <div class="answer-format">
                                     <div class="format-pattern">Expected Format: _x + _</div>
                                     <div class="format-example">Example: 4x + 3</div>
                                 </div>
                                 <div class="character-counter">
                                     <span>Character Count: <span class="char-count" id="step4-count">0</span></span>
                                     <span class="char-target">Target: ~5-8 chars</span>
                                 </div>
                                 <div class="length-hint">💡 Factor out h, cancel, then substitute h = 0</div>
                    </div>

                             <div class="input-section">
                                 <div class="input-label-container">
                                     <p class="input-label">What is \(f'(x)\)?</p>
                                 </div>

                                 <div class="input-field-container">
                                     <div class="mathquill-field" id="step4-input">
                                         <div class="real-time-feedback" id="step4-realtime"></div>
                                     </div>
                                 </div>
                                 
                                 <div class="button-group">
                             <button class="check-button" onclick="checkStep4()">Check Final Answer</button>
                             <button class="hint-button" onclick="showAdvancedHint(4, 1)">Hint Level 1</button>
                             <button class="hint-button" onclick="showAdvancedHint(4, 2)">Hint Level 2</button>
                             <button class="hint-button" onclick="showAdvancedHint(4, 3)">Show Solution</button>
                                 </div>
                             </div>
                             
                             <div class="feedback" id="step4-feedback"></div>
                             
                             <!-- Advanced Hint System -->
                             <div class="hint-system" id="hint4-level1" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 1</div>
                                 <div class="hint-content">Factor h from the numerator: h(4x + 2h + 3), then cancel with h in denominator</div>
                    </div>
                             
                             <div class="hint-system" id="hint4-level2" style="display: none;">
                                 <div class="hint-level">HINT LEVEL 2</div>
                                 <div class="hint-content">After canceling h: lim[h→0] (4x + 2h + 3). Now substitute h = 0</div>
                             </div>
                             
                             <div class="hint-system" id="hint4-level3" style="display: none;">
                                 <div class="hint-level">SOLUTION</div>
                                 <div class="hint-content">4x + 3 - This is the final derivative f'(x)</div>
                             </div>
                </div>
            </div>
        </div>
                        </div>
                </div>
                
         <!-- Quick Practice -->
         <div class="practice-problem">
             <h3>🚀 Quick Practice Challenge</h3>
             <p>Test your understanding! Find the derivative of \(g(x) = x^2 - 4x + 1\) using the definition.</p>
             
             <!-- TryHackMe Style Format Guide -->
             <div class="format-guide-container">
                 <div class="answer-format">
                     <div class="format-pattern">Expected Format: _x - _</div>
                     <div class="format-example">Example: 2x - 4</div>
                 </div>
                 <div class="character-counter">
                     <span>Character Count: <span class="char-count" id="quick-count">0</span></span>
                     <span class="char-target">Target: ~5-7 chars</span>
                 </div>
                 <div class="length-hint">💡 Apply the same 4-step process you just learned!</div>
                    </div>
                    
             <div class="input-section">
                 <div class="input-label-container">
                     <p class="input-label">Enter the derivative \(g'(x)\):</p>
                 </div>
                    
                 <div class="input-field-container">
                     <div class="mathquill-field" id="quick-practice">
                         <div class="real-time-feedback" id="quick-realtime"></div>
                     </div>
                 </div>
                 
                 <div class="button-group">
             <button class="check-button" onclick="checkQuickPractice()">Check Answer</button>
             <button class="hint-button" onclick="showAdvancedHint('quick', 1)">Hint Level 1</button>
             <button class="hint-button" onclick="showAdvancedHint('quick', 2)">Hint Level 2</button>
             <button class="hint-button" onclick="showAdvancedHint('quick', 3)">Show Solution</button>
                     <button class="demo-btn" onclick="generateNewProblem()">New Problem</button>
                 </div>
             </div>
             
             <div class="feedback" id="quick-feedback"></div>
             
             <!-- Advanced Hint System -->
             <div class="hint-system" id="hintquick-level1" style="display: none;">
                 <div class="hint-level">HINT LEVEL 1</div>
                 <div class="hint-content">Follow the same 4 steps: substitute (x+h), expand, subtract, then apply the limit</div>
             </div>
             
             <div class="hint-system" id="hintquick-level2" style="display: none;">
                 <div class="hint-level">HINT LEVEL 2</div>
                 <div class="hint-content">g(x+h) - g(x) = 2xh + h² - 4h = h(2x + h - 4). After canceling h and taking limit...</div>
             </div>
             
             <div class="hint-system" id="hintquick-level3" style="display: none;">
                 <div class="hint-level">SOLUTION</div>
                 <div class="hint-content">
                     <strong>Complete Solution:</strong><br>
                     1. g(x+h) = (x+h)² - 4(x+h) + 1 = x² + 2xh + h² - 4x - 4h + 1<br>
                     2. g(x+h) - g(x) = 2xh + h² - 4h<br>
                     3. Factor: h(2x + h - 4), cancel h<br>
                     4. lim[h→0] (2x + h - 4) = 2x - 4
                 </div>
             </div>
                    </div>
                    
         <!-- Topic Completion Section -->
         <div class="topic-completion-section" id="topic-completion" style="display: none;">
             <div class="completion-card">
                 <div class="completion-header">
                     <div class="completion-icon">🏆</div>
                     <h2>Congratulations! You've finished this topic!</h2>
                 </div>
                 <div class="completion-content">
                     <p>Click the button below to mark this topic as completed and return to your profile.</p>
                     <div class="completion-stats">
                         <div class="stat-item">
                             <span class="stat-label">Topic:</span>
                             <span class="stat-value">Definition of Derivative</span>
                         </div>
                         <div class="stat-item">
                             <span class="stat-label">Progress:</span>
                             <span class="stat-value">4/4 Tasks Complete</span>
                         </div>
                         <div class="stat-item">
                             <span class="stat-label">Next Topic:</span>
                             <span class="stat-value">Differentiation Rules</span>
                         </div>
                     </div>
                     <button class="complete-topic-btn" onclick="completeTopicAndReturn()">
                         ✓ Complete Topic & Return to Profile
                     </button>
                 </div>
             </div>
                    </div>
                    
         <!-- Navigation -->
         <div style="text-align: center; margin: 40px 0;">
             <a href="home.html" class="button">← Back to Home</a>
             <a href="rule.html" class="button">Next: Differentiation Rules →</a>
             <!-- Test button for completion (remove in production) -->
             <button onclick="showTopicCompletion()" class="button" style="background: #28a745; color: white; margin-left: 10px;">
                 🏆 Test Completion
             </button>
         </div>
     </div>
</div>

<!-- Floating Help Button -->
<div class="floating-help" onclick="toggleHelp()">
    💡
    <div class="help-tooltip" id="help-tooltip">
        <h4>Need Help?</h4>
        <ul style="text-align: left; margin: 0; padding-left: 20px;">
            <li>Click components to understand the formula</li>
            <li>Use step indicators to jump between sections</li>
            <li>Real-time feedback shows your progress</li>
            <li>Try "Show Example" for detailed solutions</li>
            <li>Generate new problems for more practice</li>
        </ul>
        <div style="text-align: center; margin-top: 10px;">
            <button onclick="resetAllProgress()" class="demo-btn">Reset Progress</button>
        </div>
    </div>
</div>

<!-- Popup Cards -->
<!-- Definition Popup -->
<div class="popup-overlay" id="definition-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">📖 Understanding the Definition of Derivative</h3>
            <div class="popup-close" onclick="closePopup('definition-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-tabs">
                <div class="popup-tab active" onclick="switchTab('def-tab1', this)">What is it?</div>
                <div class="popup-tab" onclick="switchTab('def-tab2', this)">Why this formula?</div>
                <div class="popup-tab" onclick="switchTab('def-tab3', this)">Visual Understanding</div>
            </div>
            
            <div class="popup-tab-content active" id="def-tab1">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">🎯</span>What is a Derivative?</h4>
                    <p>The derivative measures the <strong>instantaneous rate of change</strong> of a function at any point. Think of it as the slope of the tangent line to the curve at that specific point.</p>
                    
                    <div class="popup-formula">
                        \[f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                    </div>
                    
                    <div class="popup-tip">
                        <p><strong>Real-world analogy:</strong> If you're driving and your speedometer shows 60 mph at a specific moment, that's like the derivative - it tells you your instantaneous rate of change of position.</p>
                    </div>
                </div>
            </div>
            
            <div class="popup-tab-content" id="def-tab2">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">🔍</span>Breaking Down the Formula</h4>
                    <p><strong>f(x+h) - f(x):</strong> This is the change in the function value</p>
                    <p><strong>h:</strong> This is the change in the input (x-value)</p>
                    <p><strong>The fraction:</strong> Change in output ÷ Change in input = Average rate of change</p>
                    <p><strong>The limit:</strong> As h approaches 0, we get the instantaneous rate of change</p>
                    
                    <div class="popup-example">
                        <strong>Example:</strong> If f(x) = x², then:
                        <br>• f(x+h) = (x+h)²
                        <br>• f(x+h) - f(x) = (x+h)² - x²
                        <br>• This measures how much x² changes when x increases by h
                    </div>
                </div>
            </div>
            
            <div class="popup-tab-content" id="def-tab3">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">👁️</span>Visual Understanding</h4>
                    <p>Imagine zooming in on a curve until it looks like a straight line. The slope of that line is the derivative!</p>
                    
                    <div class="popup-interactive">
                        <p><strong>Interactive Concept:</strong></p>
                        <ol>
                            <li>Start with two points on a curve</li>
                            <li>Calculate the slope between them (rise/run)</li>
                            <li>Move the points closer together</li>
                            <li>As they get infinitely close, you get the derivative!</li>
                        </ol>
                    </div>
                    
                    <div class="popup-tip">
                        <p><strong>Key insight:</strong> The derivative at a point is the slope of the tangent line at that point. It tells you which direction the function is heading and how steeply.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notation Popup -->
<div class="popup-overlay" id="notation-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">📝 Derivative Notation Guide</h3>
            <div class="popup-close" onclick="closePopup('notation-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-section">
                <h4><span class="popup-section-icon">📋</span>Common Notations</h4>
                <div class="popup-formula">
                    \[f'(x) = \frac{dy}{dx} = y' = \frac{d}{dx}[f(x)]\]
                </div>
                
                <div style="display: grid; gap: 15px; margin: 20px 0;">
                    <div class="popup-example">
                        <strong>f'(x)</strong> - "f prime of x" (Lagrange notation)
                        <br><em>Most common in calculus courses</em>
                    </div>
                    
                    <div class="popup-example">
                        <strong>dy/dx</strong> - "dee y dee x" (Leibniz notation)
                        <br><em>Emphasizes the ratio concept</em>
                    </div>
                    
                    <div class="popup-example">
                        <strong>y'</strong> - "y prime" (when y = f(x))
                        <br><em>Shorthand version</em>
                    </div>
                    
                    <div class="popup-example">
                        <strong>d/dx[f(x)]</strong> - "dee dee x of f(x)"
                        <br><em>Operator notation</em>
                    </div>
                </div>
                
                <div class="popup-tip">
                    <p><strong>Pro tip:</strong> All these notations mean the same thing! Choose the one that makes most sense for your problem.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Intuition Popup -->
<div class="popup-overlay" id="intuition-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">💡 Intuitive Understanding</h3>
            <div class="popup-close" onclick="closePopup('intuition-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-tabs">
                <div class="popup-tab active" onclick="switchTab('int-tab1', this)">Real World</div>
                <div class="popup-tab" onclick="switchTab('int-tab2', this)">Geometric</div>
                <div class="popup-tab" onclick="switchTab('int-tab3', this)">Quiz</div>
            </div>
            
            <div class="popup-tab-content active" id="int-tab1">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">🌍</span>Real-World Examples</h4>
                    
                    <div class="popup-example">
                        <strong>🚗 Velocity:</strong> If position = f(t), then velocity = f'(t)
                        <br><em>How fast your position is changing at any moment</em>
                    </div>
                    
                    <div class="popup-example">
                        <strong>💰 Marginal Cost:</strong> If cost = C(x), then marginal cost = C'(x)
                        <br><em>How much the cost increases when you produce one more item</em>
                    </div>
                    
                    <div class="popup-example">
                        <strong>🌡️ Temperature Change:</strong> If temp = T(t), then rate = T'(t)
                        <br><em>How quickly temperature is rising or falling</em>
                    </div>
                    
                    <div class="popup-tip">
                        <p><strong>Key insight:</strong> Derivatives measure rates of change in any context where one quantity depends on another!</p>
                    </div>
                </div>
            </div>
            
            <div class="popup-tab-content" id="int-tab2">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">📐</span>Geometric Interpretation</h4>
                    
                    <div class="popup-interactive">
                        <p><strong>The Tangent Line Story:</strong></p>
                        <ol>
                            <li><strong>Secant Line:</strong> Draw a line through two points on the curve</li>
                            <li><strong>Move Closer:</strong> Bring the second point closer to the first</li>
                            <li><strong>Limit Process:</strong> As points get infinitely close...</li>
                            <li><strong>Tangent Line:</strong> The secant becomes the tangent!</li>
                        </ol>
                    </div>
                    
                    <div class="popup-formula">
                        \[\text{Slope of tangent} = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                    </div>
                    
                    <div class="popup-tip">
                        <p><strong>Visual tip:</strong> If the curve is steep, the derivative is large. If it's flat, the derivative is small. If it's going down, the derivative is negative!</p>
                    </div>
                </div>
            </div>
            
            <div class="popup-tab-content" id="int-tab3">
                <div class="popup-quiz">
                    <div class="quiz-question">Quick Check: What does f'(3) = 5 mean?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">The function value at x=3 is 5</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, true)">The function is increasing at rate 5 when x=3</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">The function has a maximum at x=3</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">The function equals 5 everywhere</div>
                    </div>
                </div>
                
                <div class="popup-quiz">
                    <div class="quiz-question">If a car's position is s(t) = t², what is its velocity at t=4?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">4 units/time</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, true)">8 units/time</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">16 units/time</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">2 units/time</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Polynomial Tips Popup -->
<div class="popup-overlay" id="polynomial-tips-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">🎯 Polynomial Derivative Tips</h3>
            <div class="popup-close" onclick="closePopup('polynomial-tips-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-section">
                <h4><span class="popup-section-icon">📝</span>Step-by-Step Strategy</h4>
                
                <div class="popup-example">
                    <strong>Step 1:</strong> Write f(x+h) by substituting (x+h) for every x
                    <br><strong>Step 2:</strong> Expand using algebra (especially (x+h)²)
                    <br><strong>Step 3:</strong> Subtract f(x) - most terms will cancel!
                    <br><strong>Step 4:</strong> Factor out h from the numerator
                    <br><strong>Step 5:</strong> Cancel h and take the limit
                </div>
                
                <div class="popup-tip">
                    <p><strong>Key insight:</strong> For polynomials, the constant terms and the original function terms always cancel out in step 3!</p>
                </div>
                
                <div class="popup-interactive">
                    <h5>🔧 Expansion Formulas You'll Need:</h5>
                    <div class="popup-formula">
                        \[(x+h)^2 = x^2 + 2xh + h^2\]
                        \[(x+h)^3 = x^3 + 3x^2h + 3xh^2 + h^3\]
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Common Mistakes Popup -->
<div class="popup-overlay" id="common-mistakes-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">⚠️ Avoid These Common Mistakes</h3>
            <div class="popup-close" onclick="closePopup('common-mistakes-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-tabs">
                <div class="popup-tab active" onclick="switchTab('mistake-tab1', this)">Substitution</div>
                <div class="popup-tab" onclick="switchTab('mistake-tab2', this)">Algebra</div>
                <div class="popup-tab" onclick="switchTab('mistake-tab3', this)">Limits</div>
            </div>
            
            <div class="popup-tab-content active" id="mistake-tab1">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">❌</span>Substitution Mistakes</h4>
                    
                    <div style="background: #ffebee; border: 2px solid #f44336; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>❌ WRONG:</strong> f(x+h) = f(x) + h
                        <br><em>You can't just add h to the function!</em>
                    </div>
                    
                    <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>✅ CORRECT:</strong> Replace every x with (x+h)
                        <br><em>If f(x) = 3x², then f(x+h) = 3(x+h)²</em>
                    </div>
                    
                    <div class="popup-tip">
                        <p><strong>Memory trick:</strong> Think "substitute completely" - every single x becomes (x+h)!</p>
                    </div>
                </div>
            </div>
            
            <div class="popup-tab-content" id="mistake-tab2">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">🧮</span>Algebra Mistakes</h4>
                    
                    <div style="background: #ffebee; border: 2px solid #f44336; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>❌ WRONG:</strong> (x+h)² = x² + h²
                        <br><em>Missing the middle term!</em>
                    </div>
                    
                    <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>✅ CORRECT:</strong> (x+h)² = x² + 2xh + h²
                        <br><em>Don't forget 2xh!</em>
                    </div>
                    
                    <div style="background: #ffebee; border: 2px solid #f44336; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>❌ WRONG:</strong> Canceling h before factoring
                        <br><em>Can't cancel h in 6xh + 3h² + h term by term</em>
                    </div>
                    
                    <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>✅ CORRECT:</strong> Factor first: h(6x + 3h + 1)
                        <br><em>Then cancel the h</em>
                    </div>
                </div>
            </div>
            
            <div class="popup-tab-content" id="mistake-tab3">
                <div class="popup-section">
                    <h4><span class="popup-section-icon">∞</span>Limit Mistakes</h4>
                    
                    <div style="background: #ffebee; border: 2px solid #f44336; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>❌ WRONG:</strong> Substituting h = 0 too early
                        <br><em>This gives 0/0 which is undefined!</em>
                    </div>
                    
                    <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 8px; padding: 15px; margin: 15px 0;">
                        <strong>✅ CORRECT:</strong> Simplify first, then take the limit
                        <br><em>Factor and cancel h before substituting h = 0</em>
                    </div>
                    
                    <div class="popup-tip">
                        <p><strong>Remember:</strong> The limit process is what makes the derivative work. Without it, you'd just get 0/0!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Step-by-Step Reference Popup -->
<div class="popup-overlay" id="step-by-step-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">📋 Quick Reference Guide</h3>
            <div class="popup-close" onclick="closePopup('step-by-step-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-section">
                <h4><span class="popup-section-icon">📝</span>The 5-Step Process</h4>
                
                <div style="display: grid; gap: 15px;">
                    <div class="popup-example">
                        <strong>Step 1: Set up the definition</strong>
                        <div class="popup-formula">\[f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]</div>
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 2: Find f(x+h)</strong>
                        <br>Substitute (x+h) for every x in the original function
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 3: Calculate f(x+h) - f(x)</strong>
                        <br>Expand and subtract - many terms will cancel!
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 4: Factor and simplify</strong>
                        <br>Factor out h from the numerator, then cancel with denominator
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 5: Take the limit</strong>
                        <br>Substitute h = 0 to get your final answer
                    </div>
                </div>
                
                <div class="popup-tip">
                    <p><strong>Pro tip:</strong> If you get stuck, check that you've done the algebra correctly in steps 2 and 3. That's where most errors happen!</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Practice Guide Popup -->
<div class="popup-overlay" id="practice-guide-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">🎓 Practice Guide</h3>
            <div class="popup-close" onclick="closePopup('practice-guide-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-section">
                <h4><span class="popup-section-icon">🎯</span>How to Use This Practice</h4>
                
                <div class="popup-interactive">
                    <ol>
                        <li><strong>Read each step carefully</strong> - Don't rush!</li>
                        <li><strong>Try the problem yourself first</strong> - Use the math toolbar</li>
                        <li><strong>Check your answer</strong> - Get immediate feedback</li>
                        <li><strong>Use hints if stuck</strong> - They guide you in the right direction</li>
                        <li><strong>Review mistakes</strong> - Learn from what went wrong</li>
                    </ol>
                </div>
                
                <div class="popup-tip">
                    <p><strong>Study tip:</strong> Work through each step completely before moving to the next. Understanding builds on itself!</p>
                </div>
                
                <div class="popup-quiz">
                    <div class="quiz-question">Ready to start? What should you do first?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">Jump to the final answer</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, true)">Carefully substitute (x+h) into the function</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">Memorize the formula</div>
                        <div class="quiz-option" onclick="selectQuizOption(this, false)">Skip to the hardest step</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Formula Reference Popup -->
<div class="popup-overlay" id="formula-reference-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">📐 Formula Reference</h3>
            <div class="popup-close" onclick="closePopup('formula-reference-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-section">
                <h4><span class="popup-section-icon">📋</span>Essential Formulas</h4>
                
                <div class="popup-formula">
                    <strong>Definition of Derivative:</strong>
                    \[f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\]
                </div>
                
                <div class="popup-formula">
                    <strong>Binomial Expansion:</strong>
                    \[(x+h)^2 = x^2 + 2xh + h^2\]
                    \[(x+h)^3 = x^3 + 3x^2h + 3xh^2 + h^3\]
                </div>
                
                <div class="popup-formula">
                    <strong>Factoring Pattern:</strong>
                    \[ax + bh = h(\frac{a}{h}x + b) \text{ when } a \text{ contains } h\]
                </div>
                
                <div class="popup-tip">
                    <p><strong>Quick reference:</strong> Keep these formulas handy while working through problems. The binomial expansion is especially important!</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Calculator Popup -->
<div class="popup-overlay" id="calculator-popup">
    <div class="popup-card">
        <div class="popup-header">
            <h3 class="popup-title">🧮 Step Calculator</h3>
            <div class="popup-close" onclick="closePopup('calculator-popup')">×</div>
        </div>
        <div class="popup-content">
            <div class="popup-section">
                <h4><span class="popup-section-icon">⚡</span>Quick Calculations</h4>
                
                <div class="popup-interactive">
                    <p><strong>For f(x) = 2x² + 3x:</strong></p>
                    
                    <div class="popup-example">
                        <strong>Step 1:</strong> f(x+h) = 2(x+h)² + 3(x+h)
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 2:</strong> Expand (x+h)²:
                        <br>2(x² + 2xh + h²) + 3(x+h)
                        <br>= 2x² + 4xh + 2h² + 3x + 3h
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 3:</strong> f(x+h) - f(x):
                        <br>(2x² + 4xh + 2h² + 3x + 3h) - (2x² + 3x)
                        <br>= 4xh + 2h² + 3h
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 4:</strong> Factor out h:
                        <br>h(4x + 2h + 3)
                    </div>
                    
                    <div class="popup-example">
                        <strong>Step 5:</strong> Cancel h and take limit:
                        <br>lim[h→0] (4x + 2h + 3) = 4x + 3
                    </div>
                </div>
                
                <div class="popup-tip">
                    <p><strong>Answer:</strong> f'(x) = 4x + 3</p>
                </div>
            </div>
                    </div>
                </div>
</div>

<script>
     // Global variables
     let mathFields = {};

     // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
         // Initialize dropdown functionality
        const dropdownBtns = document.querySelectorAll('.dropdown-btn');
        dropdownBtns.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                this.classList.toggle('active');
                const container = this.nextElementSibling;

                if (container.style.maxHeight && container.style.maxHeight !== '0px') {
                    container.style.maxHeight = '0px';
                } else {
                    container.style.maxHeight = container.scrollHeight + 'px';
                }
            });
        });
        
        // Initialize MathQuill fields with delay to ensure libraries are loaded
         setTimeout(() => {
         initializeMathQuill();
         }, 500);
         
         // Show first step
         const step1 = document.getElementById('step1');
         if (step1) {
             step1.classList.add('active');
         }
     });

     // Initialize MathJax
     window.MathJax = {
         tex: {
             inlineMath: [['\\(', '\\)']],
             displayMath: [['\\[', '\\]']]
         },
         svg: {
             fontCache: 'global'
         }
     };

     // Initialize MathQuill
     function initializeMathQuill() {
         console.log('Initializing MathQuill...');
         
         if (typeof MathQuill === 'undefined') {
             console.error('MathQuill is not loaded!');
             return;
         }
         
         const MQ = MathQuill.getInterface(2);
         
         // Initialize all input fields
         const fieldIds = ['step1-input', 'step2-input', 'step3-input', 'step4-input', 'quick-practice'];
         
         fieldIds.forEach(id => {
             const element = document.getElementById(id);
             if (element) {
                 console.log(`Initializing MathQuill field: ${id}`);
                 try {
                 mathFields[id] = MQ.MathField(element, {
                spaceBehavesLikeTab: true,
                handlers: {
                    edit: function() {
                                 // Provide real-time feedback
                                 provideRealTimeFeedback(id, this.latex());
                    }
                }
            });
                     console.log(`Successfully initialized: ${id}`);
                 } catch (error) {
                     console.error(`Error initializing ${id}:`, error);
                 }
             } else {
                 console.warn(`Element not found: ${id}`);
             }
         });
         
         console.log('MathQuill initialization complete. Fields:', Object.keys(mathFields));
     }

     // Highlight formula components
     function highlightComponent(component) {
         const formula = document.getElementById('main-formula');
         const explanation = document.getElementById('component-explanation');
         
         // Reset all buttons
         document.querySelectorAll('.demo-btn').forEach(btn => btn.classList.remove('active'));
         
         // Reset formula highlighting
         formula.classList.remove('formula-highlight');
         
         const explanations = {
             'derivative': {
                 text: "<strong>f'(x)</strong> - The derivative function. This tells us the rate of change of f(x) at any point x.",
                 highlight: true
             },
             'limit': {
                 text: "<strong>lim h→0</strong> - The limit as h approaches 0. This ensures we get the instantaneous rate of change.",
                 highlight: true
             },
             'difference': {
                 text: "<strong>f(x+h) - f(x)</strong> - The change in the function value. This represents how much the function changes.",
                 highlight: true
             },
             'increment': {
                 text: "<strong>h</strong> - A small increment. We divide by h to get the average rate of change over this small interval.",
                 highlight: true
             },
             'reset': {
                 text: "<em>Click on any component above to see its explanation!</em>",
                 highlight: false
             }
         };
         
         if (explanations[component]) {
             explanation.innerHTML = `<p>${explanations[component].text}</p>`;
             if (explanations[component].highlight) {
                 formula.classList.add('formula-highlight');
                 event.target.classList.add('active');
             }
         }
     }

     // Provide real-time feedback with character counting
     function provideRealTimeFeedback(fieldId, latex) {
         const feedbackElement = document.getElementById(fieldId.replace('-input', '-realtime'));
         if (!feedbackElement) return;
         
         // Update character counter
         updateCharacterCounter(fieldId, latex);
         
         let feedbackClass = 'feedback-typing';
         let feedbackText = '✏️';
         
         // Simple validation based on field
         if (latex.length > 3) {
             const stepNumber = fieldId.replace('step', '').replace('-input', '');
             const isCorrect = checkAnswerQuickly(stepNumber, latex);
             
             if (isCorrect) {
                 feedbackClass = 'feedback-correct';
                 feedbackText = '✓';
             } else if (latex.length > 10) {
                 feedbackClass = 'feedback-incorrect';
                 feedbackText = '?';
             }
         }
         
         feedbackElement.className = `real-time-feedback ${feedbackClass}`;
         feedbackElement.textContent = feedbackText;
     }

     // Update character counter
     function updateCharacterCounter(fieldId, latex) {
         const stepNumber = fieldId.replace('step', '').replace('-input', '');
         let counterId;
         
         if (fieldId === 'quick-practice') {
             counterId = 'quick-count';
         } else {
             counterId = `step${stepNumber}-count`;
         }
         
         const counterElement = document.getElementById(counterId);
         if (counterElement) {
             const cleanLatex = latex.replace(/\s/g, ''); // Remove spaces for counting
             counterElement.textContent = cleanLatex.length;
             
             // Color coding based on target length
             const targetRanges = {
                 'step1-count': [15, 20],
                 'step2-count': [25, 30],
                 'step3-count': [15, 18],
                 'step4-count': [5, 8],
                 'quick-count': [5, 7]
             };
             
             const range = targetRanges[counterId];
             if (range && cleanLatex.length >= range[0] && cleanLatex.length <= range[1]) {
                 counterElement.style.color = '#10b981'; // Green for good length
             } else if (cleanLatex.length > 0) {
                 counterElement.style.color = '#fbbf24'; // Yellow for off-target
             } else {
                 counterElement.style.color = '#10b981'; // Default green
             }
         }
     }

     // Update progress tracker
     function updateProgressTracker(step, status) {
         const progressElement = document.getElementById(`progress-step${step}`);
         const taskCounter = document.getElementById('task-counter');
         
         if (progressElement) {
             progressElement.className = `progress-status status-${status}`;
             progressElement.textContent = status.toUpperCase();
         }
         
         // Update task counter
         if (taskCounter) {
             const completedSteps = document.querySelectorAll('.status-complete').length;
             taskCounter.textContent = `${completedSteps}/4`;
         }
     }

     // Show advanced hint system
     function showAdvancedHint(step, level) {
         // Hide all hint levels for this step
         for (let i = 1; i <= 3; i++) {
             const hintElement = document.getElementById(`hint${step}-level${i}`);
             if (hintElement) {
                 hintElement.style.display = 'none';
             }
         }
         
         // Show the requested hint level
         const targetHint = document.getElementById(`hint${step}-level${level}`);
         if (targetHint) {
             targetHint.style.display = 'block';
             targetHint.scrollIntoView({ behavior: 'smooth', block: 'center' });
         }
     }

     // Quick answer checking for real-time feedback
     function checkAnswerQuickly(step, latex) {
         const patterns = {
             '1': ['2(x+h)^2+3(x+h)', '2\\left(x+h\\right)^2+3\\left(x+h\\right)'],
             '2': ['2x^2+4xh+2h^2+3x+3h', '2x^{2}+4xh+2h^{2}+3x+3h'],
             '3': ['4xh+2h^2+3h', '4xh+2h^{2}+3h'],
             '4': ['4x+3', '4x + 3'],
             'quick-practice': ['2x-4', '2x - 4']
         };
         
         if (!patterns[step]) return false;
         
         return patterns[step].some(pattern => 
             latex.includes(pattern.replace(/\s/g, '')) || 
             latex.replace(/\s/g, '').includes(pattern.replace(/\s/g, ''))
         );
     }

     // Show worked examples
     function showWorkedExample(step) {
         const examples = {
             1: "f(x) = 2x² + 3x → f(x+h) = 2(x+h)² + 3(x+h)",
             2: "2(x+h)² = 2(x² + 2xh + h²) = 2x² + 4xh + 2h²\nSo: f(x+h) = 2x² + 4xh + 2h² + 3x + 3h",
             3: "f(x+h) - f(x) = (2x² + 4xh + 2h² + 3x + 3h) - (2x² + 3x) = 4xh + 2h² + 3h",
             4: "Factor out h: h(4x + 2h + 3)\nDivide by h: 4x + 2h + 3\nLimit as h→0: 4x + 3"
         };
         
         if (examples[step]) {
             alert(`Step ${step} Example:\n\n${examples[step]}`);
         }
     }

     // Jump to specific step
     function jumpToStep(stepNum) {
         // Close all steps
         document.querySelectorAll('.step-content').forEach(content => {
             content.classList.remove('active');
         });
         
         // Open target step
         const targetStep = document.getElementById(`step${stepNum}`);
         if (targetStep) {
             targetStep.classList.add('active');
             targetStep.scrollIntoView({ behavior: 'smooth' });
         }
         
         // Update step indicators
         updateStepIndicators(stepNum);
     }

     // Update step indicators
     function updateStepIndicators(currentStep) {
         document.querySelectorAll('.step-dot').forEach((dot, index) => {
             dot.classList.remove('active');
             if (index + 1 === currentStep) {
                 dot.classList.add('active');
             }
         });
     }

     // Toggle help tooltip
     function toggleHelp() {
         const tooltip = document.getElementById('help-tooltip');
         tooltip.classList.toggle('show');
     }

     // Generate new practice problem
     function generateNewProblem() {
         const problems = [
             { func: "x² - 4x + 1", answer: "2x - 4", display: "g(x) = x² - 4x + 1" },
             { func: "3x² + 2x", answer: "6x + 2", display: "h(x) = 3x² + 2x" },
             { func: "x² + 5x - 2", answer: "2x + 5", display: "f(x) = x² + 5x - 2" },
             { func: "4x² - 3x + 1", answer: "8x - 3", display: "p(x) = 4x² - 3x + 1" }
         ];
         
         const randomProblem = problems[Math.floor(Math.random() * problems.length)];
         
         // Update problem text
         const problemText = document.querySelector('.practice-problem h3').nextElementSibling;
         problemText.innerHTML = `Test your understanding! Find the derivative of ${randomProblem.display} using the definition.`;
         
         // Clear input
         if (mathFields['quick-practice']) {
             mathFields['quick-practice'].latex('');
         }
         
         // Clear feedback
         document.getElementById('quick-feedback').style.display = 'none';
         document.getElementById('quick-realtime').textContent = '';
         
         // Store correct answer
         window.currentProblemAnswer = randomProblem.answer;
     }

     // Reset all progress
     function resetAllProgress() {
         updateStepIndicators(1);
         
         // Clear all inputs
         Object.values(mathFields).forEach(field => field.latex(''));
         
         // Hide all feedback
         document.querySelectorAll('.feedback').forEach(fb => fb.style.display = 'none');
         
         // Reset step completion
         document.querySelectorAll('.step-header').forEach(header => {
             header.classList.remove('completed');
         });
         
         // Close all steps except first
         document.querySelectorAll('.step-content').forEach((content, index) => {
             content.classList.remove('active');
             if (index === 0) content.classList.add('active');
         });
         
         alert('All inputs and progress reset! You can start fresh.');
     }



     // Toggle step visibility
     function toggleStep(stepNum) {
         const stepContent = document.getElementById(`step${stepNum}`);
         const stepHeader = stepContent.previousElementSibling;
         const arrow = stepHeader.querySelector('span:last-child');
         
         if (stepContent.classList.contains('active')) {
             stepContent.classList.remove('active');
             arrow.textContent = '▼';
         } else {
             stepContent.classList.add('active');
             arrow.textContent = '▲';
         }
     }

     // Show hints
     function showHint(stepNum) {
         const hint = document.getElementById(`hint${stepNum}`);
         if (hint) {
             hint.style.display = hint.style.display === 'none' ? 'block' : 'none';
         }
     }

     // Test function to debug MathQuill
     function testMathQuill() {
         console.log('=== MathQuill Debug Test ===');
         console.log('MathQuill available:', typeof MathQuill !== 'undefined');
         console.log('mathFields object:', mathFields);
         console.log('mathFields keys:', Object.keys(mathFields));
         
         // Test each field
         Object.keys(mathFields).forEach(fieldId => {
             const field = mathFields[fieldId];
             console.log(`Field ${fieldId}:`, field ? 'OK' : 'MISSING');
             if (field) {
                 console.log(`  - Current value: "${field.latex()}"`);
             }
         });
         
         // Test if elements exist
         const fieldIds = ['step1-input', 'step2-input', 'step3-input', 'step4-input', 'quick-practice'];
         fieldIds.forEach(id => {
             const element = document.getElementById(id);
             console.log(`Element ${id}:`, element ? 'EXISTS' : 'MISSING');
         });
         
         alert('Check the browser console for MathQuill debug information');
     }

     // Check Step 1
     function checkStep1() {
         console.log('checkStep1 called');
         
         // Check if MathQuill field exists
         if (!mathFields['step1-input']) {
             console.error('MathQuill field step1-input not found');
             alert('Please wait for the page to fully load before checking your answer.');
             return;
         }
         
         const userAnswer = mathFields['step1-input'].latex();
         console.log('User answer:', userAnswer);
         
         const correctAnswers = [
             '2(x+h)^2+3(x+h)',
             '2\\left(x+h\\right)^2+3\\left(x+h\\right)',
             '2(x+h)^{2}+3(x+h)'
         ];
         
         const feedback = document.getElementById('step1-feedback');
         
         if (correctAnswers.some(answer => userAnswer.includes('2') && userAnswer.includes('x+h') && userAnswer.includes('^2') && userAnswer.includes('3'))) {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #d4edda; color: #155724; border: 1px solid #c3e6cb;"><div class="feedback-icon" style="background: #28a745; color: white;">✓</div>🎉 Excellent! You properly substituted (x + h) for every x in the function.</div>';
             feedback.style.display = 'block';
             
             // Update progress tracker
             updateProgressTracker(1, 'complete');
             
             // Mark step as completed
             document.querySelector('#step1').closest('.step-container').querySelector('.step-header').classList.add('completed');
             updateStepIndicators(2);
             
             // Auto-open next step
             setTimeout(() => {
                 jumpToStep(2);
             }, 1500);
            } else {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;"><div class="feedback-icon" style="background: #dc3545; color: white;">✗</div>❌ Not quite right. Remember to replace every x with (x + h).</div>';
             feedback.style.display = 'block';
             updateProgressTracker(1, 'error');
         }
     }

     // Check Step 2
     function checkStep2() {
         console.log('checkStep2 called');
         
         // Check if MathQuill field exists
         if (!mathFields['step2-input']) {
             console.error('MathQuill field step2-input not found');
             alert('Please wait for the page to fully load before checking your answer.');
             return;
         }
         
         const userAnswer = mathFields['step2-input'].latex();
         console.log('User answer:', userAnswer);
         
         const feedback = document.getElementById('step2-feedback');
         
         // Check for expanded form: 2x^2 + 4xh + 2h^2 + 3x + 3h
         if (userAnswer.includes('2x^2') && userAnswer.includes('4xh') && userAnswer.includes('2h^2') && userAnswer.includes('3x') && userAnswer.includes('3h')) {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #d4edda; color: #155724; border: 1px solid #c3e6cb;"><div class="feedback-icon" style="background: #28a745; color: white;">✓</div>🎉 Perfect! You correctly expanded the expression using binomial expansion.</div>';
             feedback.style.display = 'block';
             
             updateProgressTracker(2, 'complete');
             document.querySelector('#step2').closest('.step-container').querySelector('.step-header').classList.add('completed');
             updateStepIndicators(3);
             
             setTimeout(() => {
                 jumpToStep(3);
             }, 1500);
            } else {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;"><div class="feedback-icon" style="background: #dc3545; color: white;">✗</div>❌ Check your expansion. Remember: (x + h)² = x² + 2xh + h²</div>';
             feedback.style.display = 'block';
             updateProgressTracker(2, 'error');
         }
     }

     // Check Step 3
     function checkStep3() {
         console.log('checkStep3 called');
         
         // Check if MathQuill field exists
         if (!mathFields['step3-input']) {
             console.error('MathQuill field step3-input not found');
             alert('Please wait for the page to fully load before checking your answer.');
             return;
         }
         
         const userAnswer = mathFields['step3-input'].latex();
         console.log('User answer:', userAnswer);
         
         const feedback = document.getElementById('step3-feedback');
         
         // Check for: 4xh + 2h^2 + 3h
         if (userAnswer.includes('4xh') && userAnswer.includes('2h^2') && userAnswer.includes('3h') && !userAnswer.includes('2x^2') && !userAnswer.includes('3x')) {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #d4edda; color: #155724; border: 1px solid #c3e6cb;"><div class="feedback-icon" style="background: #28a745; color: white;">✓</div>🎉 Outstanding! The 2x² and 3x terms canceled out correctly.</div>';
             feedback.style.display = 'block';
             
             updateProgressTracker(3, 'complete');
             document.querySelector('#step3').closest('.step-container').querySelector('.step-header').classList.add('completed');
             updateStepIndicators(4);
             
             setTimeout(() => {
                 jumpToStep(4);
             }, 1500);
        } else {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;"><div class="feedback-icon" style="background: #dc3545; color: white;">✗</div>❌ Remember to subtract f(x) from f(x+h). The constant terms should cancel.</div>';
             feedback.style.display = 'block';
             updateProgressTracker(3, 'error');
         }
     }

     // Check Step 4 (Final Answer)
     function checkStep4() {
         console.log('checkStep4 called');
         
         // Check if MathQuill field exists
         if (!mathFields['step4-input']) {
             console.error('MathQuill field step4-input not found');
             alert('Please wait for the page to fully load before checking your answer.');
             return;
         }
         
         const userAnswer = mathFields['step4-input'].latex();
         console.log('User answer:', userAnswer);
         
         const feedback = document.getElementById('step4-feedback');
         
         // Check for: 4x + 3
         if ((userAnswer.includes('4x+3') || userAnswer.includes('4x + 3')) && !userAnswer.includes('h')) {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #d4edda; color: #155724; border: 1px solid #c3e6cb;"><div class="feedback-icon" style="background: #28a745; color: white;">🏆</div>🏆 MISSION COMPLETE! You found the derivative: f\'(x) = 4x + 3<br/>You have mastered the definition of derivative!</div>';
             feedback.style.display = 'block';
             
             updateProgressTracker(4, 'complete');
             document.querySelector('#step4').closest('.step-container').querySelector('.step-header').classList.add('completed');
             updateStepIndicators(4);
             
             // Show celebration
             setTimeout(() => {
                 showTryHackMeCelebration();
             }, 1000);
         } else {
             feedback.innerHTML = '<div class="validation-feedback" style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;"><div class="feedback-icon" style="background: #dc3545; color: white;">✗</div>❌ Factor out h, cancel it, then apply the limit as h approaches 0.</div>';
            feedback.style.display = 'block';
            updateProgressTracker(4, 'error');
         }
     }

     // Check Quick Practice
     function checkQuickPractice() {
         console.log('checkQuickPractice called');
         
         // Check if MathQuill field exists
         if (!mathFields['quick-practice']) {
             console.error('MathQuill field quick-practice not found');
             alert('Please wait for the page to fully load before checking your answer.');
             return;
         }
         
         const userAnswer = mathFields['quick-practice'].latex();
         console.log('User answer:', userAnswer);
         
         const feedback = document.getElementById('quick-feedback');
         
         // Use current problem answer or default
         const correctAnswer = window.currentProblemAnswer || '2x - 4';
         
         // Check answer
         const answerVariations = [
             correctAnswer,
             correctAnswer.replace(' ', ''),
             correctAnswer.replace('-', ' - '),
             correctAnswer.replace('+', ' + ')
         ];
         
         const isCorrect = answerVariations.some(variation => 
             userAnswer.includes(variation) || 
             userAnswer.replace(/\s/g, '').includes(variation.replace(/\s/g, ''))
         ) && !userAnswer.includes('h');
         
         if (isCorrect) {
             feedback.innerHTML = `🎉 Correct! The derivative is ${correctAnswer}. You\'re mastering this!`;
             feedback.className = 'feedback correct';
             feedback.style.display = 'block';
        } else {
             feedback.textContent = '❌ Try again. Use the same process: find f(x+h), subtract f(x), divide by h, then take the limit.';
             feedback.className = 'feedback incorrect';
            feedback.style.display = 'block';
         }
     }



     // Show TryHackMe-style celebration animation
     function showTryHackMeCelebration() {
         // Create celebration effect
         const celebration = document.createElement('div');
         celebration.innerHTML = `
             <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                         background: linear-gradient(145deg, #0f172a, #1e293b); padding: 40px; border-radius: 15px; 
                         box-shadow: 0 0 50px rgba(16, 185, 129, 0.5); text-align: center; z-index: 1000; 
                         border: 3px solid #10b981; color: #e2e8f0; font-family: 'Courier New', monospace;">
                 <div style="color: #10b981; font-size: 3rem; margin-bottom: 20px;">🏆</div>
                 <h2 style="color: #10b981; margin: 0 0 15px 0; font-size: 2rem;">MISSION ACCOMPLISHED!</h2>
                 <div style="background: #111827; border: 1px solid #374151; border-radius: 8px; padding: 15px; margin: 20px 0;">
                     <div style="color: #10b981;">user@calculus:~$ ./derivative_complete</div>
                     <div style="color: #ffffff; margin-left: 20px;">✓ Step 1: Substitution - COMPLETE</div>
                     <div style="color: #ffffff; margin-left: 20px;">✓ Step 2: Expansion - COMPLETE</div>
                     <div style="color: #ffffff; margin-left: 20px;">✓ Step 3: Subtraction - COMPLETE</div>
                     <div style="color: #ffffff; margin-left: 20px;">✓ Step 4: Limit - COMPLETE</div>
                     <div style="color: #10b981; margin-left: 20px; margin-top: 10px;">Tasks: 4/4 Complete</div>
                 </div>
                 <p style="margin: 15px 0; font-size: 1.1rem; color: #94a3b8;">You've successfully mastered the definition of derivative!</p>
                 <button onclick="showTopicCompletion()" 
                         style="margin-top: 20px; padding: 12px 25px; background: #10b981; color: #0f172a; 
                                border: none; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 16px;
                                transition: all 0.3s ease;" 
                         onmouseover="this.style.background='#059669'" 
                         onmouseout="this.style.background='#10b981'">
                     CONTINUE LEARNING →
                 </button>
             </div>
             <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                         background: rgba(0,0,0,0.8); z-index: 999;" 
                  onclick="this.parentElement.remove()"></div>
         `;
         document.body.appendChild(celebration);
     }

     // Show topic completion section
     function showTopicCompletion() {
         // Remove celebration overlay
         const celebration = document.querySelector('[style*="position: fixed"][style*="z-index: 999"]');
         if (celebration && celebration.parentElement) {
             celebration.parentElement.remove();
         }
         
         // Show completion section
         const completionSection = document.getElementById('topic-completion');
         if (completionSection) {
             completionSection.style.display = 'flex';
             
             // Save completion status to localStorage
             saveTopicCompletion();
         }
     }

     // Save topic completion to localStorage
     function saveTopicCompletion() {
         const completionData = {
             topic: 'definition-of-derivative',
             title: 'Definition of Derivative',
             completedAt: new Date().toISOString(),
             tasksCompleted: 4,
             totalTasks: 4,
             nextTopic: 'differentiation-rules'
         };
         
         // Get existing completions
         let completions = JSON.parse(localStorage.getItem('topicCompletions') || '[]');
         
         // Remove any existing completion for this topic
         completions = completions.filter(c => c.topic !== 'definition-of-derivative');
         
         // Add new completion
         completions.push(completionData);
         
         // Save back to localStorage
         localStorage.setItem('topicCompletions', JSON.stringify(completions));
         
         console.log('Topic completion saved:', completionData);
     }

     // Complete topic and return to profile
     function completeTopicAndReturn() {
         // Show loading state
         const button = document.querySelector('.complete-topic-btn');
         const originalText = button.textContent;
         button.textContent = '✓ Marking as Complete...';
         button.disabled = true;
         
         // Simulate API call delay
         setTimeout(() => {
             // Update button to show success
             button.textContent = '✓ Topic Completed!';
             button.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
             
             // Redirect after short delay
             setTimeout(() => {
                 // Try to go to profile page, fallback to index
                 if (document.referrer && document.referrer.includes('profile')) {
                     window.location.href = document.referrer;
                 } else {
                     window.location.href = 'home.html';
                 }
             }, 1000);
         }, 1000);
     }

     // Check if topic was already completed on page load
     function checkTopicCompletion() {
         const completions = JSON.parse(localStorage.getItem('topicCompletions') || '[]');
         const thisTopicCompletion = completions.find(c => c.topic === 'definition-of-derivative');
         
         if (thisTopicCompletion) {
             console.log('Topic already completed:', thisTopicCompletion);
             // Could show a "already completed" indicator or different UI
         }
     }

     // Initialize completion checking on page load
     document.addEventListener('DOMContentLoaded', function() {
         checkTopicCompletion();
     });



     // Interactive Example Functions
     function showExampleStep(exampleId, stepNum) {
         // Hide all steps for this example
         const allSteps = document.querySelectorAll(`[id^="${exampleId}-step"], [id^="${exampleId}-mistakes"]`);
         allSteps.forEach(step => {
             const content = step.querySelector('.example-step-content');
             if (content) {
                 content.classList.remove('active');
             }
         });
         
         // Show selected step
         let targetStep;
         if (stepNum === 'mistakes') {
             targetStep = document.getElementById(`${exampleId}-mistakes`);
         } else {
             targetStep = document.getElementById(`${exampleId}-step${stepNum}`);
         }
         
         if (targetStep) {
             const content = targetStep.querySelector('.example-step-content');
             if (content) {
                 content.classList.add('active');
                 targetStep.scrollIntoView({ behavior: 'smooth', block: 'center' });
             }
         }
         
         // Update navigation buttons
         const navButtons = document.querySelectorAll(`button[onclick*="${exampleId}"]`);
         navButtons.forEach(btn => btn.classList.remove('active'));
         if (event && event.target) {
             event.target.classList.add('active');
         }
     }

     function toggleExampleStep(exampleId, stepNum) {
         let targetElement;
         if (stepNum === 'mistakes') {
             targetElement = document.getElementById(`${exampleId}-mistakes`);
         } else {
             targetElement = document.getElementById(`${exampleId}-step${stepNum}`);
         }
         
         if (!targetElement) return;
         
         const stepContent = targetElement.querySelector('.example-step-content');
         const stepHeader = targetElement.querySelector('.example-step-header');
         const arrow = stepHeader.querySelector('span:last-child');
         
         if (stepContent.classList.contains('active')) {
             stepContent.classList.remove('active');
             arrow.textContent = '▼';
             stepHeader.classList.remove('completed');
         } else {
             stepContent.classList.add('active');
             arrow.textContent = '▲';
             stepHeader.classList.add('completed');
         }
     }

     // Auto-expand first step of each example on page load
     document.addEventListener('DOMContentLoaded', function() {
         // Auto-expand first steps
         const firstSteps = ['ex1-step1', 'ex2-step1'];
         firstSteps.forEach(stepId => {
             const element = document.getElementById(stepId);
             if (element) {
                 const content = element.querySelector('.example-step-content');
                 const header = element.querySelector('.example-step-header');
                 const arrow = header.querySelector('span:last-child');
                 
                 if (content && header && arrow) {
                     content.classList.add('active');
                     arrow.textContent = '▲';
                     header.classList.add('completed');
                 }
             }
         });
         
         // Ensure mistakes sections are properly initialized
         const mistakesSections = ['ex1-mistakes', 'ex2-mistakes'];
         mistakesSections.forEach(sectionId => {
             const element = document.getElementById(sectionId);
             if (element) {
                 const content = element.querySelector('.example-step-content');
                 const header = element.querySelector('.example-step-header');
                 const arrow = header.querySelector('span:last-child');
                 
                 if (content && header && arrow) {
                     // Initially collapsed
                     content.classList.remove('active');
                     arrow.textContent = '▼';
                     header.classList.remove('completed');
                 }
             }
         });
         
         // Add click event listeners for debugging
         console.log('Initializing interactive examples...');
         
         // Test if mistakes sections exist
         const ex1Mistakes = document.getElementById('ex1-mistakes');
         const ex2Mistakes = document.getElementById('ex2-mistakes');
         
         if (ex1Mistakes) {
             console.log('Example 1 mistakes section found');
         } else {
             console.log('Example 1 mistakes section NOT found');
         }
         
         if (ex2Mistakes) {
             console.log('Example 2 mistakes section found');
         } else {
             console.log('Example 2 mistakes section NOT found');
         }
     });

     // Test function for debugging mistakes sections
     function testMistakes() {
         console.log('Testing mistakes sections...');
         
         // Test Example 1 mistakes
         showExampleStep('ex1', 'mistakes');
         setTimeout(() => {
             // Test Example 2 mistakes
             showExampleStep('ex2', 'mistakes');
         }, 2000);
     }

     // Make functions globally available for debugging
     window.showExampleStep = showExampleStep;
     window.toggleExampleStep = toggleExampleStep;
     window.testMistakes = testMistakes;

     // Popup Functions
     function openPopup(popupId) {
         const popup = document.getElementById(popupId);
         if (popup) {
             popup.style.display = 'block';
             document.body.style.overflow = 'hidden'; // Prevent background scrolling
             
             // Add click outside to close
             popup.addEventListener('click', function(e) {
                 if (e.target === popup) {
                     closePopup(popupId);
                 }
             });
             
             // Add escape key to close
             document.addEventListener('keydown', function(e) {
                 if (e.key === 'Escape') {
                     closePopup(popupId);
                 }
             });
             
             // Trigger MathJax rendering for formulas in popup
             setTimeout(() => {
                 if (window.MathJax) {
                     MathJax.typesetPromise([popup]);
                 }
             }, 100);
         }
     }

     function closePopup(popupId) {
         const popup = document.getElementById(popupId);
         if (popup) {
             popup.style.display = 'none';
             document.body.style.overflow = 'auto'; // Restore scrolling
         }
     }

     function switchTab(tabId, tabElement) {
         // Get the popup container
         const popup = tabElement.closest('.popup-card');
         
         // Hide all tab contents in this popup
         const tabContents = popup.querySelectorAll('.popup-tab-content');
         tabContents.forEach(content => content.classList.remove('active'));
         
         // Remove active class from all tabs in this popup
         const tabs = popup.querySelectorAll('.popup-tab');
         tabs.forEach(tab => tab.classList.remove('active'));
         
         // Show selected tab content
         const targetContent = document.getElementById(tabId);
         if (targetContent) {
             targetContent.classList.add('active');
         }
         
         // Add active class to clicked tab
         tabElement.classList.add('active');
         
         // Re-render MathJax for the new content
         setTimeout(() => {
             if (window.MathJax) {
                 MathJax.typesetPromise([targetContent]);
             }
         }, 100);
     }

     function selectQuizOption(optionElement, isCorrect) {
         // Remove previous selections in this quiz
         const quiz = optionElement.closest('.popup-quiz');
         const options = quiz.querySelectorAll('.quiz-option');
         options.forEach(option => {
             option.classList.remove('correct', 'incorrect');
         });
         
         // Mark the selected option
         if (isCorrect) {
             optionElement.classList.add('correct');
             optionElement.innerHTML += ' ✓';
         } else {
             optionElement.classList.add('incorrect');
             optionElement.innerHTML += ' ✗';
             
             // Also highlight the correct answer
             options.forEach(option => {
                 if (option !== optionElement && option.onclick.toString().includes('true')) {
                     option.classList.add('correct');
                     option.innerHTML += ' ✓ (Correct)';
                 }
             });
         }
         
         // Disable further clicking
         options.forEach(option => {
             option.style.pointerEvents = 'none';
         });
         
         // Show explanation after a delay
         setTimeout(() => {
             if (isCorrect) {
                 showQuizFeedback(quiz, '🎉 Correct! Great understanding!', 'correct');
             } else {
                 showQuizFeedback(quiz, '📚 Not quite right, but keep learning!', 'incorrect');
             }
         }, 1000);
     }

     function showQuizFeedback(quiz, message, type) {
         // Remove existing feedback
         const existingFeedback = quiz.querySelector('.quiz-feedback');
         if (existingFeedback) {
             existingFeedback.remove();
         }
         
         // Create new feedback
         const feedback = document.createElement('div');
         feedback.className = `quiz-feedback ${type}`;
         feedback.style.cssText = `
             margin-top: 15px;
             padding: 10px 15px;
             border-radius: 8px;
             font-weight: 600;
             text-align: center;
             ${type === 'correct' ? 
                 'background: #e8f5e8; color: #2e7d32; border: 2px solid #4caf50;' : 
                 'background: #fff3e0; color: #f57c00; border: 2px solid #ff9800;'
             }
         `;
         feedback.textContent = message;
         
         quiz.appendChild(feedback);
     }

     // Global popup functions
     window.openPopup = openPopup;
     window.closePopup = closePopup;
     window.switchTab = switchTab;
     window.selectQuizOption = selectQuizOption;

     // Add popup trigger animations on page load
     document.addEventListener('DOMContentLoaded', function() {
         // Add staggered animation to popup triggers
         const triggers = document.querySelectorAll('.popup-trigger');
         triggers.forEach((trigger, index) => {
             trigger.style.animationDelay = `${index * 0.1}s`;
         });
         
         // Add hover effects to popup triggers
         triggers.forEach(trigger => {
             trigger.addEventListener('mouseenter', function() {
                 this.style.transform = 'translateY(-3px) scale(1.05)';
             });
             
             trigger.addEventListener('mouseleave', function() {
                 this.style.transform = 'translateY(0) scale(1)';
             });
         });
     });
</script>

</body>
</html>







